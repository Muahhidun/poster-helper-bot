# –°—Ç—Ä–∞–Ω–∏—Ü–∞ ¬´–ö–∞—Ñ–µ¬ª ‚Äî –ü–æ–ª–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –±—ç–∫–µ–Ω–¥–∞

## –û–±–∑–æ—Ä

–°—Ç—Ä–∞–Ω–∏—Ü–∞ `/cafe/shift-closing` ‚Äî 2-—à–∞–≥–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∞–¥–º–∏–Ω–∞ –∫–∞—Ñ–µ (Pizzburg-cafe). –®–∞–≥ 1: –≤–≤–æ–¥ –∑–∞—Ä–ø–ª–∞—Ç (3 —Ä–æ–ª–∏ ‚Äî –ö–∞—Å—Å–∏—Ä, –°—É—à–∏—Å—Ç, –ü–æ–≤–∞—Ä –°–∞–Ω–¥–µ–π). –®–∞–≥ 2: –∑–∞–∫—Ä—ã—Ç–∏–µ —Å–º–µ–Ω—ã ‚Äî –≤–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤, —Ä–∞—Å—á—ë—Ç, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–∞, –∞–≤—Ç–æ-–ø–µ—Ä–µ–≤–æ–¥—ã –≤ Poster.

**–†–æ–ª–∏:**
- `admin` ‚Äî –ø—Ä–æ—Ö–æ–¥–∏—Ç —à–∞–≥–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ (—Å–Ω–∞—á–∞–ª–∞ –∑–∞—Ä–ø–ª–∞—Ç—ã, –ø–æ—Ç–æ–º –∑–∞–∫—Ä—ã—Ç–∏–µ)
- `owner` ‚Äî –≤–∏–¥–∏—Ç –æ–±–∞ —à–∞–≥–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ, –º–æ–∂–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É –¥–∞—Ç–∞–º–∏

**–ö–ª—é—á–µ–≤–æ–µ –æ—Ç–ª–∏—á–∏–µ –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –æ—Ç–¥–µ–ª–∞:**
- –ù–µ—Ç Halyk —Ç–µ—Ä–º–∏–Ω–∞–ª–∞
- –ï—Å—Ç—å –ø–æ–ª–µ `kaspi_pizzburg` (–∫—É—Ä—å–µ—Ä—ã –¥–æ—Å—Ç–∞–≤–∫–∏ —á–µ—Ä–µ–∑ Kaspi –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –æ—Ç–¥–µ–ª–∞)
- `kaspi_pizzburg` **–ü–†–ò–ë–ê–í–õ–Ø–ï–¢–°–Ø** –∫ –±–µ–∑–Ω–∞–ª—É (–≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç `kaspi_cafe` –≤ –æ—Å–Ω–æ–≤–Ω–æ–º, –∫–æ—Ç–æ—Ä—ã–π –≤—ã—á–∏—Ç–∞–µ—Ç—Å—è)
- –ù–µ—Ç –ø–æ–ª—è `deposits` (–≤–Ω–µ—Å–µ–Ω–∏–π)
- –ó–∞—Ä–ø–ª–∞—Ç—ã –≤–≤–æ–¥—è—Ç—Å—è –≤—Ä—É—á–Ω—É—é (—Å—É–º–º—ã), –∞ –Ω–µ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ —Ç–∞–±–ª–∏—Ü–∞–º

---

## 1. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –¥–æ—Å—Ç—É–ø

### 1.1 –†–æ–ª–∏ –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è

```python
def check_role_access(path, role):
    if role == 'owner':
        return True  # owner –≤–∏–¥–∏—Ç –≤—Å—ë
    if role == 'admin':
        if path.startswith('/cafe/') or path.startswith('/api/cafe/'):
            return True
        if path == '/logout':
            return True
        return False
    return False

def get_home_for_role(role):
    if role == 'admin':
        return '/cafe/shift-closing'  # –¥–æ–º–∞—à–Ω—è—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–¥–º–∏–Ω–∞
```

### 1.2 –†–µ–∑–æ–ª–≤ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–∞—Ñ–µ

```python
def resolve_cafe_info():
    db = get_database()
    role = session.get('role')

    if role == 'admin':
        # –ê–¥–º–∏–Ω: –±–µ—Ä—ë–º poster_account_id –∏–∑ —Å–µ—Å—Å–∏–∏
        poster_account_id = session.get('poster_account_id')
        if poster_account_id:
            info = db.get_web_user_poster_info(session['web_user_id'])
            if info:
                return info

    elif role == 'owner':
        # Owner: –±–µ—Ä—ë–º –ù–ï-primary –∞–∫–∫–∞—É–Ω—Ç (Pizzburg-cafe)
        telegram_user_id = session.get('telegram_user_id')
        accounts = db.get_accounts(telegram_user_id)
        cafe_account = next((a for a in accounts if not a.get('is_primary')), None)
        if cafe_account:
            return {
                'telegram_user_id': telegram_user_id,
                'poster_account_id': cafe_account['id'],
                'account_name': cafe_account.get('account_name', 'Cafe'),
                'poster_token': cafe_account.get('poster_token'),
                'poster_user_id': cafe_account.get('poster_user_id'),
                'poster_base_url': cafe_account.get('poster_base_url'),
            }

    abort(403)
```

**–í–ê–ñ–ù–û:** –î–ª—è –∫–∞—Ñ–µ `resolve_cafe_info()` –≤—ã–±–∏—Ä–∞–µ—Ç **–Ω–µ primary** –∞–∫–∫–∞—É–Ω—Ç (–≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç `resolve_cashier_info()` –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–±–∏—Ä–∞–µ—Ç primary).

---

## 2. ID —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Å—á–µ—Ç–æ–≤ –∫–∞—Ñ–µ

```python
CAFE_ACCOUNTS = {
    'kaspi': 1,        # –ö–∞—Å–ø–∏ –ü–µ–π
    'inkassacia': 2,   # –ò–Ω–∫–∞—Å—Å–∞—Ü–∏—è (–≤–µ—á–µ—Ä–æ–º)
    'cash_left': 5,    # –û—Å—Ç–∞–≤–∏–ª –≤ –∫–∞—Å—Å–µ (–Ω–∞ –∑–∞–∫—É–ø—ã)
    'wolt': 7,         # Wolt –¥–æ—Å—Ç–∞–≤–∫–∞
}
```

**–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –æ—Å–Ω–æ–≤–Ω—ã–º –æ—Ç–¥–µ–ª–æ–º:**

| –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ö–∞—Ñ–µ (ID) | –û—Å–Ω–æ–≤–Ω–æ–π (ID) |
|-----------|-----------|---------------|
| Kaspi | 1 | 1 |
| –ò–Ω–∫–∞—Å—Å–∞—Ü–∏—è | 2 | 2 |
| –û—Å—Ç–∞–≤–∏–ª –≤ –∫–∞—Å—Å–µ | **5** | **4** |
| Wolt | **7** | **8** |
| Halyk | ‚Äî (–Ω–µ—Ç) | 10 |

---

## 3. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–ö–∞—Ñ–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç—É –∂–µ —Ç–∞–±–ª–∏—Ü—É `shift_closings`, —á—Ç–æ –∏ –æ—Å–Ω–æ–≤–Ω–æ–π –æ—Ç–¥–µ–ª. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ ‚Äî –ø–æ `poster_account_id`.

### 3.1 –¢–∞–±–ª–∏—Ü–∞ `shift_closings`

```sql
CREATE TABLE IF NOT EXISTS shift_closings (
    id SERIAL PRIMARY KEY,
    telegram_user_id BIGINT NOT NULL,
    date DATE NOT NULL,
    poster_account_id INTEGER DEFAULT NULL,  -- NULL = –æ—Å–Ω–æ–≤–Ω–æ–π, NOT NULL = –∫–∞—Ñ–µ

    -- –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    wolt REAL DEFAULT 0,
    halyk REAL DEFAULT 0,
    kaspi REAL DEFAULT 0,
    kaspi_cafe REAL DEFAULT 0,           -- —Ç–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω–æ–π (–≤—ã—á–∏—Ç–∞–µ—Ç—Å—è)
    kaspi_pizzburg REAL DEFAULT 0,       -- —Ç–æ–ª—å–∫–æ –∫–∞—Ñ–µ (–ø—Ä–∏–±–∞–≤–ª—è–µ—Ç—Å—è)
    cash_bills REAL DEFAULT 0,
    cash_coins REAL DEFAULT 0,
    shift_start REAL DEFAULT 0,
    deposits REAL DEFAULT 0,             -- —Ç–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω–æ–π
    expenses REAL DEFAULT 0,
    cash_to_leave REAL DEFAULT 15000,    -- –∫–∞—Ñ–µ default = 10000

    -- –î–∞–Ω–Ω—ã–µ Poster (—Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Ç–µ–Ω–≥–µ –ø–æ—Å–ª–µ √∑100)
    poster_trade REAL DEFAULT 0,
    poster_bonus REAL DEFAULT 0,
    poster_card REAL DEFAULT 0,
    poster_cash REAL DEFAULT 0,
    transactions_count INTEGER DEFAULT 0,

    -- –†–∞—Å—á—ë—Ç–Ω—ã–µ –ø–æ–ª—è
    fact_cashless REAL DEFAULT 0,
    fact_total REAL DEFAULT 0,
    fact_adjusted REAL DEFAULT 0,
    poster_total REAL DEFAULT 0,
    day_result REAL DEFAULT 0,
    shift_left REAL DEFAULT 0,
    collection REAL DEFAULT 0,
    cashless_diff REAL DEFAULT 0,

    -- –ó–∞—Ä–ø–ª–∞—Ç—ã (—Ç–æ–ª—å–∫–æ –¥–ª—è –∫–∞—Ñ–µ)
    salaries_created BOOLEAN DEFAULT FALSE,
    salaries_data TEXT DEFAULT NULL,       -- JSON: [{role, name, amount}, ...]

    -- –ü–µ—Ä–µ–≤–æ–¥—ã
    transfers_created BOOLEAN DEFAULT FALSE,

    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);
```

**–£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å:**
- –û—Å–Ω–æ–≤–Ω–æ–π: `WHERE poster_account_id IS NULL` ‚Äî –æ–¥–∏–Ω —Ä–µ–∫–æ—Ä–¥ –Ω–∞ (user, date)
- –ö–∞—Ñ–µ: `WHERE poster_account_id = X` ‚Äî –æ–¥–∏–Ω —Ä–µ–∫–æ—Ä–¥ –Ω–∞ (user, date, account)

### 3.2 –ú–µ—Ç–æ–¥—ã –ë–î

#### `save_shift_closing(telegram_user_id, date, data, poster_account_id=None)` ‚Üí bool

UPSERT. –î–ª—è –∫–∞—Ñ–µ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è `poster_account_id`:
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `SELECT id WHERE ... AND poster_account_id = %s`
- –ï—Å–ª–∏ –µ—Å—Ç—å ‚Üí UPDATE, –∏–Ω–∞—á–µ ‚Üí INSERT
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç 24 —á–∏—Å–ª–æ–≤—ã—Ö –ø–æ–ª—è (–≤—Å–µ –≤—Ö–æ–¥–Ω—ã–µ + —Ä–∞—Å—á—ë—Ç–Ω—ã–µ)

#### `get_shift_closing(telegram_user_id, date, poster_account_id=None)` ‚Üí dict | None

–î–ª—è –∫–∞—Ñ–µ: `WHERE poster_account_id = %s`. –î–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ: `WHERE poster_account_id IS NULL`.

#### `get_shift_closing_dates(telegram_user_id, limit=30, poster_account_id=None)` ‚Üí list

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–∞—Ç (—Å—Ç—Ä–æ–∫–∏ `YYYY-MM-DD`) –≤ –ø–æ—Ä—è–¥–∫–µ —É–±—ã–≤–∞–Ω–∏—è. –î–ª—è –∫–∞—Ñ–µ ‚Äî —Ç–æ–ª—å–∫–æ –¥–∞—Ç—ã —Å `poster_account_id`.

#### `set_transfers_created(telegram_user_id, date, poster_account_id=None)` ‚Üí bool

–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `transfers_created = 1/TRUE`.

#### `set_cafe_salaries(telegram_user_id, date, poster_account_id, salaries_data)` ‚Üí bool

–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –∫–∞—Ñ–µ:
- –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Üí UPDATE `salaries_created = TRUE, salaries_data = JSON`
- –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí INSERT –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ —Å `salaries_created` –∏ `salaries_data`
- –ü–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞—Ä–ø–ª–∞—Ç—ã **–¥–æ** –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∑–∞–∫—Ä—ã—Ç–∏—è —Å–º–µ–Ω—ã (—à–∞–≥ 1 —Ä–∞–Ω—å—à–µ —à–∞–≥–∞ 2)

---

## 4. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞—Ç—ã

–¢–æ—Ç –∂–µ –ø–∞—Ç—Ç–µ—Ä–Ω: –¥–æ 6:00 —É—Ç—Ä–∞ = –≤—á–µ—Ä–∞.

```python
kz_now = datetime.now(pytz.timezone('Asia/Almaty'))
if kz_now.hour >= 6:
    date_str = kz_now.strftime('%Y-%m-%d')
else:
    date_str = (kz_now - timedelta(days=1)).strftime('%Y-%m-%d')
```

---

## 5. API Endpoints

### 5.1 –°—Ç—Ä–∞–Ω–∏—Ü–∞

**`GET /cafe/shift-closing`**

```python
@app.route('/cafe/shift-closing')
def cafe_shift_closing():
    info = resolve_cafe_info()
    role = session.get('role', 'admin')
    return render_template('shift_closing_cafe.html',
                           account_name=info.get('account_name', 'Cafe'),
                           user_role=role)
```

---

### 5.2 `GET /api/cafe/poster-data`

–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö Poster –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä `?date=YYYYMMDD`.

**–õ–æ–≥–∏–∫–∞:**
1. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¥–∞—Ç—É (–ø–∞—Ä–∞–º–µ—Ç—Ä –∏–ª–∏ –±–∏–∑–Ω–µ—Å-–¥–µ–Ω—å)
2. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ (`asyncio.gather`) –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç:
   - `dash.getTransactions` –∑–∞ —É–∫–∞–∑–∞–Ω–Ω—É—é –¥–∞—Ç—É
   - `finance.getCashShifts` –∑–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –¥–µ–Ω—å (–¥–ª—è `shift_start`)
3. –§–∏–ª—å—Ç—Ä—É–µ—Ç –∑–∞–∫—Ä—ã—Ç—ã–µ –∑–∞–∫–∞–∑—ã (`status == '2'`)
4. –°—É–º–º–∏—Ä—É–µ—Ç `payed_cash`, `payed_card`, `payed_sum` (–≤—Å–µ –≤ —Ç–∏–π–∏–Ω–∞—Ö, –∑–Ω–∞—á–µ–Ω–∏—è ‚Äî **—Å—Ç—Ä–æ–∫–∏**, –Ω—É–∂–µ–Ω `int()`)
5. `bonus = payed_sum - payed_cash - payed_card` (–µ—Å–ª–∏ <0 ‚Üí 0)
6. –ò–∑ –∫–∞—Å—Å–æ–≤—ã—Ö —Å–º–µ–Ω –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –¥–Ω—è –±–µ—Ä—ë—Ç `amount_end` –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–º–µ–Ω—ã ‚Üí `poster_prev_shift_left`
7. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:** –ò—â–µ—Ç –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å–º–µ–Ω—ã (`poster_account_id IS NULL`) –ø–æ–ª–µ `kaspi_cafe` ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–∞–∫ `main_kaspi_cafe` –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è `kaspi_pizzburg`

**Response:**
```json
{
    "success": true,
    "date": "20260228",
    "transactions_count": 42,
    "account_name": "Pizzburg-cafe",
    "trade_total": 4250000,
    "bonus": 45000,
    "poster_card": 4200000,
    "poster_cash": 5000,
    "poster_prev_shift_left": 150000,
    "main_kaspi_cafe": 23000
}
```

**–í–ê–ñ–ù–û:** `trade_total`, `bonus`, `poster_card`, `poster_cash`, `poster_prev_shift_left` ‚Äî –≤ **—Ç–∏–π–∏–Ω–∞—Ö**. –§—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–µ—Ä–µ–¥–∞—ë—Ç –∏—Ö –≤ `/api/cafe/calculate` –∫–∞–∫ –µ—Å—Ç—å, –∞ calculate –¥–µ–ª–∞–µ—Ç `√∑ 100`.

---

### 5.3 `POST /api/cafe/calculate`

–†–∞—Å—á—ë—Ç –∏—Ç–æ–≥–æ–≤ –∑–∞–∫—Ä—ã—Ç–∏—è —Å–º–µ–Ω—ã –∫–∞—Ñ–µ.

**Request:**
```json
{
    "wolt": 45000,
    "kaspi": 120000,
    "kaspi_pizzburg": 23000,
    "cash_bills": 67000,
    "cash_coins": 3500,
    "shift_start": 15000,
    "expenses": 0,
    "cash_to_leave": 10000,
    "poster_trade": 4250000,
    "poster_bonus": 45000,
    "poster_card": 4200000
}
```

–í—Å–µ –ø–æ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞ (wolt, kaspi, ...) –≤ **—Ç–µ–Ω–≥–µ**. Poster-–ø–æ–ª—è (poster_trade, ...) –≤ **—Ç–∏–π–∏–Ω–∞—Ö**.

**–§–æ—Ä–º—É–ª—ã (–ö–ê–§–ï):**
```python
# –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è Poster-–¥–∞–Ω–Ω—ã—Ö: —Ç–∏–π–∏–Ω—ã ‚Üí —Ç–µ–Ω–≥–µ
poster_trade = poster_trade_input / 100
poster_bonus = poster_bonus_input / 100
poster_card  = poster_card_input  / 100

# 1. –ë–µ–∑–Ω–∞–ª = Wolt + Kaspi + Kaspi Pizzburg (–ü–†–ò–ë–ê–í–õ–Ø–ï–¢–°–Ø!)
fact_cashless = wolt + kaspi + kaspi_pizzburg

# 2. –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π = –±–µ–∑–Ω–∞–ª + –±—É–º–∞–∂–Ω—ã–µ + –º–µ–ª–æ—á—å
fact_total = fact_cashless + cash_bills + cash_coins

# 3. –ò—Ç–æ–≥–æ —Ñ–∞–∫—Ç = –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π - –°–º–µ–Ω–∞ –Ω–∞—á–∞–ª–æ + –†–∞—Å—Ö–æ–¥—ã (–ù–ï–¢ deposits!)
fact_adjusted = fact_total - shift_start + expenses

# 4. –ò—Ç–æ–≥–æ Poster = –¢–æ—Ä–≥–æ–≤–ª—è - –ë–æ–Ω—É—Å—ã
poster_total = poster_trade - poster_bonus

# 5. –ò–¢–û–ì–û –î–ï–ù–¨ = –ò—Ç–æ–≥–æ —Ñ–∞–∫—Ç - –ò—Ç–æ–≥–æ Poster
day_result = fact_adjusted - poster_total

# 6. –°–º–µ–Ω–∞ –æ—Å—Ç–∞–≤–∏–ª–∏ = –û—Å—Ç–∞–≤–∏—Ç—å + –ú–µ–ª–æ—á—å
shift_left = cash_to_leave + cash_coins

# 7. –†–∞–∑–Ω–∏—Ü–∞ –±–µ–∑–Ω–∞–ª–∞ = –ë–µ–∑–Ω–∞–ª —Ñ–∞–∫—Ç - Poster card
cashless_diff = fact_cashless - poster_card

# 8. –ò–Ω–∫–∞—Å—Å–∞—Ü–∏—è = –ë—É–º–∞–∂–Ω—ã–µ - –û—Å—Ç–∞–≤–∏—Ç—å + –†–∞—Å—Ö–æ–¥—ã + –†–∞–∑–Ω–∏—Ü–∞ –±–µ–∑–Ω–∞–ª–∞
collection = cash_bills - cash_to_leave + expenses + cashless_diff
```

**–û—Ç–ª–∏—á–∏—è –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –æ—Ç–¥–µ–ª–∞:**
- `kaspi_pizzburg` **–ø—Ä–∏–±–∞–≤–ª—è–µ—Ç—Å—è** (–æ—Å–Ω–æ–≤–Ω–æ–π: `kaspi_cafe` **–≤—ã—á–∏—Ç–∞–µ—Ç—Å—è**)
- –ù–µ—Ç `deposits` –≤ —Ñ–æ—Ä–º—É–ª–µ `fact_adjusted`
- –ù–µ—Ç `halyk` –≤–æ–æ–±—â–µ
- `cash_to_leave` default = 10000 (–æ—Å–Ω–æ–≤–Ω–æ–π = 15000)

**Response:**
```json
{
    "success": true,
    "calculations": {
        "wolt": 45000,
        "kaspi": 120000,
        "kaspi_pizzburg": 23000,
        "cash_bills": 67000,
        "cash_coins": 3500,
        "shift_start": 15000,
        "expenses": 0,
        "cash_to_leave": 10000,
        "poster_trade": 42500.0,
        "poster_bonus": 450.0,
        "poster_card": 42000.0,
        "fact_cashless": 188000.0,
        "fact_total": 258500.0,
        "fact_adjusted": 243500.0,
        "poster_total": 42050.0,
        "day_result": 201450.0,
        "shift_left": 13500.0,
        "collection": 59500.0,
        "cashless_diff": 146000.0
    }
}
```

---

### 5.4 `POST /api/cafe/save`

–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞–∫—Ä—ã—Ç–∏—è —Å–º–µ–Ω—ã.

**Request:** –ª—é–±—ã–µ –ø–æ–ª—è –∏–∑ `shift_closings` (—Ç–µ –∂–µ —á—Ç–æ –≤ calculate response, –ø–ª—é—Å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ `date`).

**–õ–æ–≥–∏–∫–∞:**
```python
db.save_shift_closing(
    telegram_user_id, date, data,
    poster_account_id=info['poster_account_id']  # –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–ª—è –∫–∞—Ñ–µ
)
```

**Response:**
```json
{"success": true, "date": "2026-02-28"}
```

---

### 5.5 `GET /api/cafe/history?date=YYYY-MM-DD`

–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∑–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –¥–∞—Ç—É.

**Response:**
```json
{
    "success": true,
    "date": "2026-02-28",
    "closing": {
        "id": 42,
        "wolt": 45000,
        "kaspi": 120000,
        "kaspi_pizzburg": 23000,
        "collection": 59500,
        "transfers_created": true,
        "salaries_created": true,
        "salaries_data": "[{\"role\":\"–ö–∞—Å—Å–∏—Ä\",\"name\":\"–ê–π–≥—É–ª—å\",\"amount\":15000}]",
        ...
    }
}
```

`closing` –º–æ–∂–µ—Ç –±—ã—Ç—å `null` –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç.

---

### 5.6 `GET /api/cafe/dates`

–°–ø–∏—Å–æ–∫ –¥–∞—Ç —Å –¥–∞–Ω–Ω—ã–º–∏ –∑–∞–∫—Ä—ã—Ç–∏—è (–¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ –¥–Ω—è–º).

**Response:**
```json
{
    "success": true,
    "dates": ["2026-02-28", "2026-02-27", "2026-02-26"]
}
```

–î–æ 30 –¥–∞—Ç –≤ –ø–æ—Ä—è–¥–∫–µ —É–±—ã–≤–∞–Ω–∏—è.

---

### 5.7 `GET /api/cafe/report?date=YYYY-MM-DD`

–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –æ—Ç—á—ë—Ç–∞ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è.

**Response:**
```json
{
    "success": true,
    "date": "2026-02-28",
    "report": "üìã Pizzburg-cafe ‚Äî –ó–∞–∫—Ä—ã—Ç–∏–µ —Å–º–µ–Ω—ã 28.02.2026\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüí≥ –ë–µ–∑–Ω–∞–ª —Ç–µ—Ä–º–∏–Ω–∞–ª—ã:\n   Wolt: 45 000‚Ç∏\n   Kaspi: 120 000‚Ç∏\n   Kaspi Pizzburg (–∫—É—Ä—å–µ—Ä—ã): +23 000‚Ç∏\n   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n   –ò—Ç–æ–≥–æ –±–µ–∑–Ω–∞–ª: 188 000‚Ç∏\n\nüíµ –ù–∞–ª–∏—á–Ω—ã–µ:\n   –ë—É–º–∞–∂–Ω—ã–µ: 67 000‚Ç∏\n   –ú–µ–ª–æ—á—å: 3 500‚Ç∏\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüìä –°–≤–µ—Ä–∫–∞:\n   –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π: 258 500‚Ç∏\n   –°–º–µ–Ω–∞ –Ω–∞—á–∞–ª–æ: 15 000‚Ç∏\n   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n   –ò—Ç–æ–≥–æ —Ñ–∞–∫—Ç: 243 500‚Ç∏\n\n   Poster —Ç–æ—Ä–≥–æ–≤–ª—è: 42 500‚Ç∏\n   Poster –±–æ–Ω—É—Å—ã: -450‚Ç∏\n   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n   –ò—Ç–æ–≥–æ Poster: 42 050‚Ç∏\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüìà –ò–¢–û–ì–û –î–ï–ù–¨: +201 450‚Ç∏ (–∏–∑–ª–∏—à–µ–∫)\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\nüí∞ –ò–Ω–∫–∞—Å—Å–∞—Ü–∏—è: 59 500‚Ç∏\nüîÑ –°–º–µ–Ω–∞ –æ—Å—Ç–∞–≤–∏–ª–∏: 13 500‚Ç∏\n\n‚ÑπÔ∏è –†–∞–∑–Ω–∏—Ü–∞ –±–µ–∑–Ω–∞–ª: +146 000‚Ç∏ (—É—á—Ç–µ–Ω–æ –≤ –∏–Ω–∫–∞—Å—Å–∞—Ü–∏–∏)"
}
```

**–§–æ—Ä–º–∞—Ç –æ—Ç—á—ë—Ç–∞:**
- `kaspi_pizzburg` –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ > 0
- `expenses` –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ > 0
- `cashless_diff` –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ |diff| ‚â• 1‚Ç∏
- Day result: emoji üìà/üìâ/‚úÖ + "–∏–∑–ª–∏—à–µ–∫"/"–Ω–µ–¥–æ—Å—Ç–∞—á–∞"/"—Ä–æ–≤–Ω–æ"

---

### 5.8 `GET /api/cafe/salaries/status?date=YYYY-MM-DD`

–ü—Ä–æ–≤–µ—Ä–∫–∞, —Å–æ–∑–¥–∞–Ω—ã –ª–∏ –∑–∞—Ä–ø–ª–∞—Ç—ã –∑–∞ –¥–∞—Ç—É.

**Response (—Å–æ–∑–¥–∞–Ω—ã):**
```json
{
    "success": true,
    "salaries_created": true,
    "salaries_data": [
        {"role": "–ö–∞—Å—Å–∏—Ä", "name": "–ê–π–≥—É–ª—å", "amount": 15000},
        {"role": "–°—É—à–∏—Å—Ç", "name": "–ó—É—Ö—Ä–∞", "amount": 12000},
        {"role": "–ü–æ–≤–∞—Ä –°–∞–Ω–¥–µ–π", "name": "–ú–∞–¥–∏–Ω–∞", "amount": 10000}
    ]
}
```

**Response (–Ω–µ —Å–æ–∑–¥–∞–Ω—ã):**
```json
{
    "success": true,
    "salaries_created": false,
    "salaries_data": null
}
```

---

### 5.9 `GET /api/cafe/employees/last`

–ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –∏–º–µ–Ω–∞ –∏ —Å—É–º–º—ã.

**–õ–æ–≥–∏–∫–∞:** –ø—Ä—è–º–æ–π SQL-–∑–∞–ø—Ä–æ—Å:
```sql
SELECT salaries_data FROM shift_closings
WHERE telegram_user_id = %s
  AND poster_account_id = %s
  AND salaries_data IS NOT NULL
ORDER BY date DESC LIMIT 1
```

**Response:**
```json
{
    "success": true,
    "salaries": [
        {"role": "–ö–∞—Å—Å–∏—Ä", "name": "–ê–π–≥—É–ª—å", "amount": 15000},
        {"role": "–°—É—à–∏—Å—Ç", "name": "–ó—É—Ö—Ä–∞", "amount": 12000},
        {"role": "–ü–æ–≤–∞—Ä –°–∞–Ω–¥–µ–π", "name": "–ú–∞–¥–∏–Ω–∞", "amount": 10000}
    ]
}
```

---

### 5.10 `POST /api/cafe/salaries/create`

–°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∑–∞—Ä–ø–ª–∞—Ç –∫–∞—Ñ–µ.

**Request:**
```json
{
    "salaries": [
        {"role": "–ö–∞—Å—Å–∏—Ä", "name": "–ê–π–≥—É–ª—å", "amount": 15000},
        {"role": "–°—É—à–∏—Å—Ç", "name": "–ó—É—Ö—Ä–∞", "amount": 12000},
        {"role": "–ü–æ–≤–∞—Ä –°–∞–Ω–¥–µ–π", "name": "–ú–∞–¥–∏–Ω–∞", "amount": 10000}
    ]
}
```

**–ú–∞–ø–ø–∏–Ω–≥ —Ä–æ–ª–µ–π ‚Üí –∫–∞—Ç–µ–≥–æ—Ä–∏–π Poster:**

| –†–æ–ª—å | Category ID | –°–ø–æ—Å–æ–± –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è |
|------|------------|-------------------|
| –ö–∞—Å—Å–∏—Ä | 16 | –ó–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω |
| –°—É—à–∏—Å—Ç | 17 | –ó–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω |
| –ü–æ–≤–∞—Ä –°–∞–Ω–¥–µ–π | auto | –ü–æ–∏—Å–∫ –ø–æ API: `get_categories()` ‚Üí –∏—â–µ—Ç "–ø–æ–≤–∞—Ä" + "—Å–∞–Ω–¥", fallback "–ø–æ–≤–∞—Ä" |

**–°—á—ë—Ç –¥–ª—è –≤—Å–µ—Ö –∑–∞—Ä–ø–ª–∞—Ç:** `account_from_id = 5` (–û—Å—Ç–∞–≤–∏–ª –≤ –∫–∞—Å—Å–µ)

**–õ–æ–≥–∏–∫–∞:**
1. **–ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–µ–π:** –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `salaries_created` –≤ `shift_closings` –∑–∞ —Å–µ–≥–æ–¥–Ω—è
2. –î–ª—è –∫–∞–∂–¥–æ–π –∑–∞—Ä–ø–ª–∞—Ç—ã:
   - –ù–∞—Ö–æ–¥–∏—Ç `category_id` –ø–æ –º–∞–ø–ø–∏–Ω–≥—É
   - –î–ª—è "–ü–æ–≤–∞—Ä –°–∞–Ω–¥–µ–π": –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç `poster_client.get_categories()` –∏ –∏—â–µ—Ç –ø–æ –∏–º–µ–Ω–∏
   - –ï—Å–ª–∏ `amount <= 0` ‚Üí –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç
   - –ï—Å–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ ‚Üí –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ `skipped`
   - –ò–Ω–∞—á–µ ‚Üí `poster_client.create_transaction(type=0, category=cat_id, account_from=5, amount=X, comment=name)`
3. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —á–µ—Ä–µ–∑ `db.set_cafe_salaries(user_id, date, poster_account_id, salaries_json)`

**Poster API –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞—Ä–ø–ª–∞—Ç—ã:**
```
POST finance.createTransaction
  type = 0                    # —Ä–∞—Å—Ö–æ–¥
  category = 16/17/auto       # –ø–æ —Ä–æ–ª–∏
  account_from = 5            # –û—Å—Ç–∞–≤–∏–ª –≤ –∫–∞—Å—Å–µ (–ö–ê–§–ï!)
  amount = 15000              # –í –¢–ï–ù–ì–ï
  date = "2026-02-28 21:45:00"
  comment = "–ê–π–≥—É–ª—å"          # –∏–º—è –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
```

**Response (—É—Å–ø–µ—Ö):**
```json
{
    "success": true,
    "salaries": [
        {"role": "–ö–∞—Å—Å–∏—Ä", "name": "–ê–π–≥—É–ª—å", "amount": 15000, "tx_id": "abc123"},
        {"role": "–°—É—à–∏—Å—Ç", "name": "–ó—É—Ö—Ä–∞", "amount": 12000, "tx_id": "abc124"},
        {"role": "–ü–æ–≤–∞—Ä –°–∞–Ω–¥–µ–π", "name": "–ú–∞–¥–∏–Ω–∞", "amount": 10000, "tx_id": "abc125"}
    ],
    "total": 37000
}
```

**Response (—á–∞—Å—Ç–∏—á–Ω–æ, —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º):**
```json
{
    "success": true,
    "salaries": [...],
    "total": 27000,
    "warning": "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å: –ü–æ–≤–∞—Ä –°–∞–Ω–¥–µ–π –ú–∞–¥–∏–Ω–∞",
    "skipped": [{"role": "–ü–æ–≤–∞—Ä –°–∞–Ω–¥–µ–π", "name": "–ú–∞–¥–∏–Ω–∞", "amount": 10000, "reason": "–ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ Poster"}]
}
```

**Response (–¥—É–±–ª—å):**
```json
{
    "success": false,
    "error": "–ó–∞—Ä–ø–ª–∞—Ç—ã –∑–∞ —Å–µ–≥–æ–¥–Ω—è —É–∂–µ —Å–æ–∑–¥–∞–Ω—ã"
}
```

---

### 5.11 `POST /api/cafe/transfers`

–°–æ–∑–¥–∞–Ω–∏–µ –∞–≤—Ç–æ-–ø–µ—Ä–µ–≤–æ–¥–æ–≤ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç".

**Request:**
```json
{
    "date": "2026-02-28"
}
```

`date` –æ–ø—Ü–∏–æ–Ω–∞–ª–µ–Ω (default = –±–∏–∑–Ω–µ—Å-–¥–µ–Ω—å).

**–õ–æ–≥–∏–∫–∞:**
1. –ó–∞–≥—Ä—É–∂–∞–µ—Ç `shift_closings` –∑–∞ –¥–∞—Ç—É
2. **–ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–µ–π:** –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `transfers_created`
3. –°—Ç—Ä–æ–∏—Ç —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–≤–æ–¥–æ–≤:

#### –ü–µ—Ä–µ–≤–æ–¥ 1: –ò–Ω–∫–∞—Å—Å–∞—Ü–∏—è ‚Üí –û—Å—Ç–∞–≤–∏–ª –≤ –∫–∞—Å—Å–µ

–°–æ–∑–¥–∞—ë—Ç—Å—è –µ—Å–ª–∏ `collection > 0`.

```
from: 2 (–ò–Ω–∫–∞—Å—Å–∞—Ü–∏—è)
to:   5 (–û—Å—Ç–∞–≤–∏–ª –≤ –∫–∞—Å—Å–µ)
amount: round(collection)
```

#### –ü–µ—Ä–µ–≤–æ–¥ 2: –ö–∞—Å–ø–∏–π ‚Üí –í–æ–ª—å—Ç

–°–æ–∑–¥–∞—ë—Ç—Å—è –µ—Å–ª–∏ `wolt > 0`.

```
from: 1 (–ö–∞—Å–ø–∏–π –ü–µ–π)
to:   7 (Wolt)
amount: round(wolt)
```

#### –ü–µ—Ä–µ–≤–æ–¥ 3: –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –±–µ–∑–Ω–∞–ª–∞

–°–æ–∑–¥–∞—ë—Ç—Å—è –µ—Å–ª–∏ `|cashless_diff| > 0.5`.

**–ï—Å–ª–∏ cashless_diff < -0.5** (—Ñ–∞–∫—Ç –±–µ–∑–Ω–∞–ª < Poster):
```
name: "–ö–æ—Ä—Ä. –±–µ–∑–Ω–∞–ª–∞: –ö–∞—Å–ø–∏–π ‚Üí –û—Å—Ç–∞–≤–∏–ª"
from: 1 (–ö–∞—Å–ø–∏–π –ü–µ–π)
to:   5 (–û—Å—Ç–∞–≤–∏–ª –≤ –∫–∞—Å—Å–µ)
amount: round(|cashless_diff|)
```

**–ï—Å–ª–∏ cashless_diff > 0.5** (—Ñ–∞–∫—Ç –±–µ–∑–Ω–∞–ª > Poster):
```
name: "–ö–æ—Ä—Ä. –±–µ–∑–Ω–∞–ª–∞: –û—Å—Ç–∞–≤–∏–ª ‚Üí –ö–∞—Å–ø–∏–π"
from: 5 (–û—Å—Ç–∞–≤–∏–ª –≤ –∫–∞—Å—Å–µ)
to:   1 (–ö–∞—Å–ø–∏–π –ü–µ–π)
amount: round(cashless_diff)
```

4. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞:
```python
await client.create_transaction(
    transaction_type=2,   # –ø–µ—Ä–µ–≤–æ–¥
    category_id=0,        # –±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    account_from_id=t['from'],
    account_to_id=t['to'],
    amount=t['amount'],   # –≤ —Ç–µ–Ω–≥–µ
    date=f'{date} 22:00:00',
    comment=''
)
```

5. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `transfers_created = TRUE`

**Response:**
```json
{
    "success": true,
    "created_count": 3,
    "transfers": [
        {"name": "–ò–Ω–∫–∞—Å—Å–∞—Ü–∏—è ‚Üí –û—Å—Ç–∞–≤–∏–ª –≤ –∫–∞—Å—Å–µ", "amount": 59500, "tx_id": "xyz001"},
        {"name": "–ö–∞—Å–ø–∏–π ‚Üí –í–æ–ª—å—Ç", "amount": 45000, "tx_id": "xyz002"},
        {"name": "–ö–æ—Ä—Ä. –±–µ–∑–Ω–∞–ª–∞: –û—Å—Ç–∞–≤–∏–ª ‚Üí –ö–∞—Å–ø–∏–π", "amount": 146000, "tx_id": "xyz003"}
    ],
    "message": "3 –ø–µ—Ä–µ–≤–æ–¥(–∞) —Å–æ–∑–¥–∞–Ω–æ"
}
```

**Response (—É–∂–µ —Å–æ–∑–¥–∞–Ω–æ):**
```json
{
    "success": true,
    "already_created": true,
    "message": "–ü–µ—Ä–µ–≤–æ–¥—ã —É–∂–µ —Å–æ–∑–¥–∞–Ω—ã —Ä–∞–Ω–µ–µ"
}
```

**Response (–Ω–µ—á–µ–≥–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å):**
```json
{
    "success": true,
    "created_count": 0,
    "message": "–ù–µ—Ç –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è (—Å—É–º–º—ã = 0)"
}
```

---

## 6. –õ–æ–≥–∏–∫–∞ –∏–Ω–∫–∞—Å—Å–∞—Ü–∏–∏ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –±–µ–∑–Ω–∞–ª–∞

### 6.1 –ü–æ—á–µ–º—É `+cashless_diff` –≤ —Ñ–æ—Ä–º—É–ª–µ collection

```
collection = cash_bills - cash_to_leave + expenses + cashless_diff
```

**–ó–Ω–∞–∫ `+` (–ù–ï –º–∏–Ω—É—Å!):**

- `cashless_diff > 0` (—Ñ–∞–∫—Ç –±–µ–∑–Ω–∞–ª –±–æ–ª—å—à–µ Poster): Poster –¥—É–º–∞–µ—Ç —á—Ç–æ –Ω–∞–ª–∏—á–Ω—ã—Ö –≤ –∫–∞—Å—Å–µ –±–æ–ª—å—à–µ, —á–µ–º –µ—Å—Ç—å ‚Üí –∏–Ω–∫–∞—Å—Å–∏—Ä—É–µ–º –ë–û–õ–¨–®–ï —á—Ç–æ–±—ã POS-—Å–º–µ–Ω–∞ –∑–∞–∫—Ä—ã–ª–∞—Å—å –∑–µ–ª—ë–Ω–æ–π
- `cashless_diff < 0` (—Ñ–∞–∫—Ç –±–µ–∑–Ω–∞–ª –º–µ–Ω—å—à–µ Poster): Poster –¥—É–º–∞–µ—Ç —á—Ç–æ –Ω–∞–ª–∏—á–Ω—ã—Ö –º–µ–Ω—å—à–µ ‚Üí –∏–Ω–∫–∞—Å—Å–∏—Ä—É–µ–º –ú–ï–ù–¨–®–ï

### 6.2 –ü—Ä–∏–º–µ—Ä

```
–í–≤–æ–¥: –ë—É–º–∞–∂–Ω—ã–µ=67000, –ú–µ–ª–æ—á—å=3500, –û—Å—Ç–∞–≤–∏—Ç—å=10000, –†–∞—Å—Ö–æ–¥—ã=0
       –§–∞–∫—Ç –±–µ–∑–Ω–∞–ª=188000, Poster card=42000

cashless_diff = 188000 - 42000 = +146000
collection = 67000 - 10000 + 0 + 146000 = 203000

–ö–∞—Å—Å–∏—Ä/–∞–¥–º–∏–Ω –≤–≤–æ–¥–∏—Ç –≤ Poster POS –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –∫–∞—Å—Å–æ–≤–æ–π —Å–º–µ–Ω—ã: 203000‚Ç∏

–ü–µ—Ä–µ–≤–æ–¥—ã:
  1. –ò–Ω–∫–∞—Å—Å–∞—Ü–∏—è(2) ‚Üí –û—Å—Ç–∞–≤–∏–ª(5): 203000‚Ç∏
  2. –ö–∞—Å–ø–∏–π(1) ‚Üí Wolt(7): 45000‚Ç∏
  3. –û—Å—Ç–∞–≤–∏–ª(5) ‚Üí –ö–∞—Å–ø–∏–π(1): 146000‚Ç∏ (–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞)

–ò—Ç–æ–≥–æ –Ω–∞ —Å—á—ë—Ç–µ "–û—Å—Ç–∞–≤–∏–ª –≤ –∫–∞—Å—Å–µ": +203000 - 146000 = +57000‚Ç∏ (—Ñ–∏–∑–∏—á–µ—Å–∫–∞—è –∏–Ω–∫–∞—Å—Å–∞—Ü–∏—è)
–ò—Ç–æ–≥–æ –Ω–∞ —Å—á—ë—Ç–µ "–ö–∞—Å–ø–∏–π": -45000 + 146000 = +101000‚Ç∏ (—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π Kaspi –∑–∞ –¥–µ–Ω—å)
```

---

## 7. Poster API

### 7.1 `dash.getTransactions`

```
GET https://{account}.joinposter.com/api/dash.getTransactions
  ?token={token}&dateFrom=YYYYMMDD&dateTo=YYYYMMDD
```

Response: –º–∞—Å—Å–∏–≤ –∑–∞–∫–∞–∑–æ–≤. –§–∏–ª—å—Ç—Ä: `status == '2'` (–∑–∞–∫—Ä—ã—Ç—ã–µ).
–ü–æ–ª—è: `payed_cash`, `payed_card`, `payed_sum`, `payed_bonus` ‚Äî —Å—Ç—Ä–æ–∫–∏, —Ç–∏–π–∏–Ω—ã.

### 7.2 `finance.getCashShifts`

```
GET https://{account}.joinposter.com/api/finance.getCashShifts
  ?token={token}&dateFrom=YYYYMMDD&dateTo=YYYYMMDD
```

Response: –º–∞—Å—Å–∏–≤ –∫–∞—Å—Å–æ–≤—ã—Ö —Å–º–µ–Ω. –ë–µ—Ä—ë–º `amount_end` –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–º–µ–Ω—ã –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –¥–Ω—è ‚Üí `shift_start`.

### 7.3 `finance.getExpenseCategories` (–¥–ª—è –ü–æ–≤–∞—Ä –°–∞–Ω–¥–µ–π)

```
GET https://{account}.joinposter.com/api/finance.getExpenseCategories
  ?token={token}
```

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è auto-detect –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "–ü–æ–≤–∞—Ä –°–∞–Ω–¥–µ–π":
1. –ò—â–µ—Ç `category_name` —Å–æ–¥–µ—Ä–∂–∞—â–µ–µ "–ø–æ–≤–∞—Ä" –ò "—Å–∞–Ω–¥"
2. Fallback: —Ç–æ–ª—å–∫–æ "–ø–æ–≤–∞—Ä"

### 7.4 `finance.createTransaction`

–ó–∞—Ä–ø–ª–∞—Ç—ã: `type=0`, `amount` –≤ —Ç–µ–Ω–≥–µ, `comment` = –∏–º—è.
–ü–µ—Ä–µ–≤–æ–¥—ã: `type=2`, `account_from_id` –∏ `account_to_id`, –≤—Ä–µ–º—è `22:00:00`.

---

## 8. UI –°—Ç—Ä—É–∫—Ç—É—Ä–∞ (2 —à–∞–≥–∞)

### –®–∞–≥ 1: –ó–∞—Ä–ø–ª–∞—Ç—ã

**3 –±–ª–æ–∫–∞ (—Ä–æ–ª–∏):**

–ö–∞–∂–¥—ã–π –±–ª–æ–∫ —Å–æ–¥–µ—Ä–∂–∏—Ç:
- –ù–∞–∑–≤–∞–Ω–∏–µ —Ä–æ–ª–∏ (–ö–∞—Å—Å–∏—Ä / –°—É—à–∏—Å—Ç / –ü–æ–≤–∞—Ä –°–∞–Ω–¥–µ–π)
- Input: –ò–º—è (—Ç–µ–∫—Å—Ç)
- Input: –°—É–º–º–∞ (—á–∏—Å–ª–æ, —Ç–µ–Ω–≥–µ)

**–ü–æ–¥ –±–ª–æ–∫–∞–º–∏:**
- –°—Ç—Ä–æ–∫–∞ "–ò—Ç–æ–≥–æ" ‚Äî —Å—É–º–º–∞ –≤—Å–µ—Ö –∑–∞—Ä–ø–ª–∞—Ç
- –ö–Ω–æ–ø–∫–∞ "–î–∞–ª–µ–µ" (–¥–ª—è admin) / "–°–æ–∑–¥–∞—Ç—å –∑–∞—Ä–ø–ª–∞—Ç—ã" (–¥–ª—è owner)

**–ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ:** –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `/api/cafe/employees/last` ‚Äî –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è –∏–º–µ–Ω–∞ –∏ —Å—É–º–º—ã –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–º–µ–Ω—ã.

**–°—Ç–∞—Ç—É—Å:** –µ—Å–ª–∏ –∑–∞—Ä–ø–ª–∞—Ç—ã —É–∂–µ —Å–æ–∑–¥–∞–Ω—ã ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å readonly —Å–ø–∏—Å–æ–∫ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∑–∞—Ä–ø–ª–∞—Ç.

### –®–∞–≥ 2: –ó–∞–∫—Ä—ã—Ç–∏–µ —Å–º–µ–Ω—ã

**–°–µ–ª–µ–∫—Ç–æ—Ä –¥–∞—Ç—ã:** –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫ —Å –¥–∞—Ç–∞–º–∏. –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ `/api/cafe/dates`.

**–ö–∞—Ä—Ç–æ—á–∫–∞ "–ë–µ–∑–Ω–∞–ª":**
- Input: Wolt
- Input: Kaspi
- Input: Kaspi Pizzburg (–∫—É—Ä—å–µ—Ä—ã) ‚Äî –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∏–∑ `main_kaspi_cafe`

**–ö–∞—Ä—Ç–æ—á–∫–∞ "–ù–∞–ª–∏—á–Ω—ã–µ":**
- Input: –ë—É–º–∞–∂–Ω—ã–µ
- Input: –ú–µ–ª–æ—á—å

**–ö–∞—Ä—Ç–æ—á–∫–∞ "–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏":**
- Input: –°–º–µ–Ω–∞ –Ω–∞—á–∞–ª–æ ‚Äî –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∏–∑ Poster (`poster_prev_shift_left √∑ 100`)
- Input: –†–∞—Å—Ö–æ–¥—ã
- Input: –û—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ —Å–º–µ–Ω—É (default 10000)

**–ë–ª–æ–∫ "–î–∞–Ω–Ω—ã–µ Poster" (readonly):**
- –¢–æ—Ä–≥–æ–≤–ª—è (poster_trade)
- –ë–æ–Ω—É—Å—ã (poster_bonus)
- –ë–µ–∑–Ω–∞–ª Poster (poster_card)
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤ (transactions_count)

**–ë–ª–æ–∫ "–†–∞—Å—á—ë—Ç":**
- –ò—Ç–æ–≥–æ –±–µ–∑–Ω–∞–ª —Ñ–∞–∫—Ç
- –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π
- –ò—Ç–æ–≥–æ —Ñ–∞–∫—Ç
- –ò—Ç–æ–≥–æ Poster

**–ë–ª–æ–∫ "–ò–¢–û–ì–û –î–ï–ù–¨":**
- –ë–æ–ª—å—à–∞—è —Ü–∏—Ñ—Ä–∞ —Å —Ü–≤–µ—Ç–æ–º: –∑–µ–ª—ë–Ω—ã–π (–∏–∑–ª–∏—à–µ–∫), –∫—Ä–∞—Å–Ω—ã–π (–Ω–µ–¥–æ—Å—Ç–∞—á–∞)

**–ë–ª–æ–∫ "–ò–Ω–∫–∞—Å—Å–∞—Ü–∏—è":**
- –ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞ (collection)
- –°–º–µ–Ω–∞ –æ—Å—Ç–∞–≤–∏–ª–∏
- –†–∞–∑–Ω–∏—Ü–∞ –±–µ–∑–Ω–∞–ª–∞ (–µ—Å–ª–∏ |diff| ‚â• 1)

**–ö–Ω–æ–ø–∫–∏:**
- "–û—Ç—á—ë—Ç —Å–º–µ–Ω—ã" ‚Üí –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –æ—Ç—á—ë—Ç–∞
- "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å" ‚Üí –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ + —Å–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–æ–≤
- –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –∫–Ω–æ–ø–∫–∞ –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ "–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ! (–ø–µ—Ä–µ–≤–æ–¥—ã ‚úì)"

### –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ

- Debounce 250ms –ø—Ä–∏ –≤–≤–æ–¥–µ ‚Üí –ø–µ—Ä–µ—Å—á—ë—Ç —á–µ—Ä–µ–∑ `/api/cafe/calculate`
- Debounce 1500ms ‚Üí –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `/api/cafe/save`
- LocalStorage: –∫–ª—é—á `cafe_sc_YYYY-MM-DD` –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–≤–æ–¥–∞

---

## 9. –ü–æ–≤–µ–¥–µ–Ω–∏–µ Owner

–ö–æ–≥–¥–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç owner:
1. **–û–±–∞ —à–∞–≥–∞ –≤–∏–¥–Ω—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ** (–Ω–µ—Ç –ø–æ—à–∞–≥–æ–≤–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏)
2. **Step indicator —Å–∫—Ä—ã—Ç**
3. –¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –∑–∞—Ä–ø–ª–∞—Ç: "–°–æ–∑–¥–∞—Ç—å –∑–∞—Ä–ø–ª–∞—Ç—ã" –≤–º–µ—Å—Ç–æ "–î–∞–ª–µ–µ"
4. –ú–æ–∂–µ—Ç —Å–≤–æ–±–æ–¥–Ω–æ **–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å –¥–∞—Ç—ã** –∏ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é
5. –ú–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞—Ä–ø–ª–∞—Ç—ã –∏ –ø–µ—Ä–µ–≤–æ–¥—ã, –µ—Å–ª–∏ –∞–¥–º–∏–Ω –µ—â—ë –Ω–µ —Å–¥–µ–ª–∞–ª
6. –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ: –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `/api/cafe/salaries/status` ‚Äî –µ—Å–ª–∏ —É–∂–µ —Å–æ–∑–¥–∞–Ω—ã ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç readonly —Å–ø–∏—Å–æ–∫

**Readonly —Ä–µ–∂–∏–º:**
- –ü—Ä–æ—à–ª—ã–µ –¥–∞—Ç—ã ‚Üí readonly (–≤—Å–µ input disabled)
- –°–µ–≥–æ–¥–Ω—è ‚Üí —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ
- –ö–Ω–æ–ø–∫–∞ "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å" –¥–ª—è —Å–Ω—è—Ç–∏—è readonly

---

## 10. –°–≤—è–∑—å Kaspi Pizzburg

**–ë–∏–∑–Ω–µ—Å-–∫–æ–Ω—Ç–µ–∫—Å—Ç:** –ö—É—Ä—å–µ—Ä—ã Pizzburg-cafe –∏—Å–ø–æ–ª—å–∑—É—é—Ç Kaspi-—Ç–µ—Ä–º–∏–Ω–∞–ª –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –æ—Ç–¥–µ–ª–∞ (Pizzburg). –ü–æ—ç—Ç–æ–º—É:

1. –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ **–æ—Å–Ω–æ–≤–Ω–æ–≥–æ –æ—Ç–¥–µ–ª–∞** `/shift-closing` –≤–ª–∞–¥–µ–ª–µ—Ü –≤–≤–æ–¥–∏—Ç `kaspi_cafe` ‚Äî —Å—É–º–º–∞ Kaspi –æ–ø–ª–∞—Ç, –æ—Ç–Ω–æ—Å—è—â–∏—Ö—Å—è –∫ –∫–∞—Ñ–µ
2. –≠—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `shift_closings.kaspi_cafe` (primary row)
3. –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ **–∫–∞—Ñ–µ** `/cafe/shift-closing` –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ Poster-–¥–∞–Ω–Ω—ã—Ö –±—ç–∫–µ–Ω–¥ –∏—â–µ—Ç `kaspi_cafe` –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–∞–∫ `main_kaspi_cafe`
4. –§—Ä–æ–Ω—Ç–µ–Ω–¥ –∫–∞—Ñ–µ –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω—è–µ—Ç –ø–æ–ª–µ `kaspi_pizzburg` —ç—Ç–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ–º

**–§–æ—Ä–º—É–ª–∞:** `kaspi_pizzburg` –ø—Ä–∏–±–∞–≤–ª—è–µ—Ç—Å—è –∫ –±–µ–∑–Ω–∞–ª—É –∫–∞—Ñ–µ, –∞ `kaspi_cafe` –≤—ã—á–∏—Ç–∞–µ—Ç—Å—è –∏–∑ –±–µ–∑–Ω–∞–ª–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ. –ò—Ç–æ–≥–æ: –¥–µ–Ω—å–≥–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –º–µ–∂–¥—É –∑–∞–≤–µ–¥–µ–Ω–∏—è–º–∏.

---

## 11. –ù–∞–≤–∏–≥–∞—Ü–∏—è

–ù–∞–≤–∏–≥–∞—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –¥–ª—è owner** (`{% if user_role == 'owner' %}`):

–°—Å—ã–ª–∫–∏: –†–∞—Å—Ö–æ–¥—ã ‚Üí –ü–æ—Å—Ç–∞–≤–∫–∏ ‚Üí –°–º–µ–Ω–∞ ‚Üí –ö–∞—Å—Å–∏—Ä ‚Üí **–ö–∞—Ñ–µ** (active)

–ê–¥–º–∏–Ω –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∑–∞–≤–µ–¥–µ–Ω–∏—è –∏ —Ä–∞–±–æ—á—É—é –æ–±–ª–∞—Å—Ç—å.

---

## 12. –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–µ–π

| –î–µ–π—Å—Ç–≤–∏–µ | –§–ª–∞–≥ | –ü—Ä–æ–≤–µ—Ä–∫–∞ |
|---------|------|---------|
| –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—Ä–ø–ª–∞—Ç | `salaries_created` | –ü–µ—Ä–µ–¥ `create_transaction()` |
| –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ | `transfers_created` | –ü–µ—Ä–µ–¥ `create_transaction()` |

–û–±–∞ —Ñ–ª–∞–≥–∞ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `shift_closings` –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π (user, date, poster_account_id).

---

## 13. –ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è)

1. **–¢–∞–±–ª–∏—Ü–∞ `shift_closings`** ‚Äî –µ—Å–ª–∏ –µ—â—ë –Ω–µ —Å–æ–∑–¥–∞–Ω–∞ (–æ–±—â–∞—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º –æ—Ç–¥–µ–ª–æ–º)
2. **DB –º–µ—Ç–æ–¥—ã** ‚Äî `save_shift_closing`, `get_shift_closing`, `get_shift_closing_dates`, `set_transfers_created`, `set_cafe_salaries`
3. **`resolve_cafe_info()`** ‚Äî –≤—ã–±–æ—Ä –ù–ï-primary –∞–∫–∫–∞—É–Ω—Ç–∞
4. **`CAFE_ACCOUNTS`** ‚Äî –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ —Å ID —Å—á–µ—Ç–æ–≤
5. **`GET /api/cafe/poster-data`** ‚Äî –¥–∞–Ω–Ω—ã–µ Poster + –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ `kaspi_pizzburg`
6. **`POST /api/cafe/calculate`** ‚Äî —Ñ–æ—Ä–º—É–ª—ã –∫–∞—Ñ–µ
7. **`POST /api/cafe/save`** ‚Äî —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
8. **`GET /api/cafe/history`** –∏ **`GET /api/cafe/dates`** ‚Äî –∏—Å—Ç–æ—Ä–∏—è
9. **`GET /api/cafe/report`** ‚Äî —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç—á—ë—Ç
10. **`GET /api/cafe/salaries/status`** –∏ **`GET /api/cafe/employees/last`** ‚Äî —Å—Ç–∞—Ç—É—Å –∑–∞—Ä–ø–ª–∞—Ç
11. **`POST /api/cafe/salaries/create`** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞—Ä–ø–ª–∞—Ç (Poster API + auto-detect –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
12. **`POST /api/cafe/transfers`** ‚Äî –∞–≤—Ç–æ-–ø–µ—Ä–µ–≤–æ–¥—ã (3 —à—Ç)
13. **`GET /cafe/shift-closing`** ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞
14. **Frontend** ‚Äî 2-—à–∞–≥–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å owner-—Ä–µ–∂–∏–º–æ–º
