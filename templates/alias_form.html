{% extends "base.html" %}

{% block title %}{% if mode == 'new' %}–î–æ–±–∞–≤–∏—Ç—å{% else %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å{% endif %} Alias{% endblock %}

{% block content %}
<h2>{% if mode == 'new' %}‚ûï –î–æ–±–∞–≤–∏—Ç—å{% else %}‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å{% endif %} Alias</h2>

<form method="post" class="mt-4">
    <div class="mb-3">
        <label for="alias_text" class="form-label">Alias —Ç–µ–∫—Å—Ç <span class="text-danger">*</span></label>
        <input type="text" class="form-control" id="alias_text" name="alias_text"
               value="{{ alias.alias_text if alias else '' }}" required>
        <div class="form-text">–¢–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ö–æ–ª–∞ –ü–≠–¢ 1–ª√ó12")</div>
    </div>

    <div class="mb-3">
        <label class="form-label">–¢–∏–ø <span class="text-danger">*</span></label><br>
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="source" id="ingredient" value="ingredient"
                   {% if not alias or alias.source == 'ingredient' %}checked{% endif %} required>
            <label class="form-check-label" for="ingredient">–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç</label>
        </div>
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="source" id="product" value="product"
                   {% if alias and alias.source == 'product' %}checked{% endif %}>
            <label class="form-check-label" for="product">–ü—Ä–æ–¥—É–∫—Ç</label>
        </div>
    </div>

    <div class="mb-3">
        <label for="poster_item_name" class="form-label">–¢–æ–≤–∞—Ä (–Ω–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –¥–ª—è –ø–æ–∏—Å–∫–∞) <span class="text-danger">*</span></label>
        <input type="text" class="form-control" id="poster_item_name" name="poster_item_name"
               value="{{ alias.poster_item_name if alias else '' }}"
               list="items_list" required autocomplete="off">
        <datalist id="items_list">
            {% for item in items %}
            <option value="{{ item.name }}" data-id="{{ item.id }}">{{ item.name }} (ID: {{ item.id }})</option>
            {% endfor %}
        </datalist>
        <input type="hidden" id="poster_item_id" name="poster_item_id"
               value="{{ alias.poster_item_id if alias else '' }}" required>
        <div class="form-text">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä –∏–∑ —Å–ø–∏—Å–∫–∞ Poster</div>
    </div>

    <div class="mb-3">
        <label for="notes" class="form-label">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
        <input type="text" class="form-control" id="notes" name="notes"
               value="{{ alias.notes if alias else '' }}">
        <div class="form-text">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ alias</div>
    </div>

    <div class="mt-4">
        <a href="{{ url_for('list_aliases') }}" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</a>
        <button type="submit" class="btn btn-primary">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
</form>
{% endblock %}

{% block scripts %}
<script>
    // Auto-fill poster_item_id when user selects from datalist
    const posterItemNameInput = document.getElementById('poster_item_name');
    const posterItemIdInput = document.getElementById('poster_item_id');
    const itemsList = document.getElementById('items_list');

    posterItemNameInput.addEventListener('input', function() {
        const selectedOption = Array.from(itemsList.options).find(
            option => option.value === posterItemNameInput.value
        );

        if (selectedOption) {
            posterItemIdInput.value = selectedOption.getAttribute('data-id');
        } else {
            // Clear the hidden field if no match
            posterItemIdInput.value = '';
        }
    });

    // Validation on form submit
    document.querySelector('form').addEventListener('submit', function(e) {
        if (!posterItemIdInput.value) {
            e.preventDefault();
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä –∏–∑ —Å–ø–∏—Å–∫–∞');
        }
    });
</script>
{% endblock %}
