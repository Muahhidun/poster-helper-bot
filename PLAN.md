# PLAN.md ‚Äî –ó–∞–∫—Ä—ã—Ç–∏–µ –¥–Ω—è: Wizard –Ω–∞ —Å–∞–π—Ç–µ

> –≠—Ç–æ—Ç —Ñ–∞–π–ª –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –µ–¥–∏–Ω–æ–≥–æ flow "–ó–∞–∫—Ä—ã—Ç–∏–µ –¥–Ω—è" –Ω–∞ —Å–∞–π—Ç–µ.
> –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –±–∏–∑–Ω–µ—Å-—Ñ–ª–æ—É ‚Äî —Å–º. **CLAUDE.md** ‚Üí "–ë–∏–∑–Ω–µ—Å-—Ñ–ª–æ—É: –ó–∞–∫—Ä—ã—Ç–∏–µ –¥–Ω—è"

## –¶–µ–ª—å

–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–∫—Ä—ã—Ç–∏—è –¥–Ω—è –Ω–∞ —Å–∞–π—Ç, –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä—É—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è. –¢—Ä–∏ –∫–ª—é—á–µ–≤—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–∞:
1. **–ê–¥–º–∏–Ω –ö–∞—Ñ–µ** ‚Äî –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –ö–∞—Ñ–µ —á–µ—Ä–µ–∑ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É (`/cafe/{token}/shift-closing`, —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
2. **–ö–∞—Å—Å–∏—Ä –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –æ—Ç–¥–µ–ª–∞** ‚Äî –≤–≤–æ–¥–∏—Ç –∑–∞—Ä–ø–ª–∞—Ç—ã –∏ 5 –∑–Ω–∞—á–µ–Ω–∏–π —á–µ—Ä–µ–∑ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É (`/cashier/{token}/shift-closing`, **–ù–û–í–û–ï**)
3. **–í–ª–∞–¥–µ–ª–µ—Ü** ‚Äî –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ—Ç –æ–±–æ–∏—Ö, –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –¥–µ–Ω—å —á–µ—Ä–µ–∑ Mini App + –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–µ—Ä–µ–≤–æ–¥—ã

---

## –¢–ï–ö–£–©–ê–Ø –ó–ê–î–ê–ß–ê: –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ö–∞—Å—Å–∏—Ä–∞ + –ê–≤—Ç–æ-–ø–µ—Ä–µ–≤–æ–¥—ã

### –û–±–∑–æ—Ä

–°–æ–∑–¥–∞—ë–º –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –ö–∞—Å—Å–∏—Ä–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –æ—Ç–¥–µ–ª–∞ –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω—É –ö–∞—Ñ–µ (`shift_closing_cafe.html`). –ö–∞—Å—Å–∏—Ä –¥–µ–ª–∞–µ—Ç –¥–≤–µ –≤–µ—â–∏:
1. –í–≤–æ–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –∑–∞—Ä–ø–ª–∞—Ç ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç ‚Üí —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –≤ Poster
2. –í–≤–æ–¥–∏—Ç 5 –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è —Å–º–µ–Ω—ã ‚Üí –¥–∞–Ω–Ω—ã–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è —É –≤–ª–∞–¥–µ–ª—å—Ü–∞

–ü–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è —Å–º–µ–Ω—ã –æ–±–æ–∏—Ö –æ—Ç–¥–µ–ª–æ–≤ ‚Äî –∞–≤—Ç–æ-–ø–µ—Ä–µ–≤–æ–¥—ã –æ–¥–Ω–æ–π –∫–Ω–æ–ø–∫–æ–π.

---

### –®–∞–≥ 1: –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ö–∞—Å—Å–∏—Ä–∞ ‚Äî –ó–∞—Ä–ø–ª–∞—Ç—ã

**URL:** `/cashier/{token}/shift-closing`
**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è:** Plain HTML + vanilla JS (–∫–∞–∫ `shift_closing_cafe.html`)

**–≠–∫—Ä–∞–Ω 1 ‚Äî –í–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∑–∞—Ä–ø–ª–∞—Ç:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –û—Å–Ω–æ–≤–Ω–æ–π –æ—Ç–¥–µ–ª ‚Äî –ó–∞–∫—Ä—ã—Ç–∏–µ     ‚îÇ
‚îÇ                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ –ö–∞—Å—Å–∏—Ä—ã ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ  [2 –∫–∞—Å—Å–∏—Ä–∞] [3 –∫–∞—Å—Å–∏—Ä–∞]‚îÇ    ‚îÇ
‚îÇ  ‚îÇ                         ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  –ö–∞—Å—Å–∏—Ä 1: [–ú–µ—Ä—É–µ—Ä—Ç   ]‚îÇ    ‚îÇ ‚Üê –∞–≤—Ç–æ–ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—á–µ—Ä–∞—à–Ω–∏—Ö
‚îÇ  ‚îÇ  –ö–∞—Å—Å–∏—Ä 2: [–ë–∞—Ç–∏–º–∞     ]‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  (–ö–∞—Å—Å–∏—Ä 3: [        ] )‚îÇ    ‚îÇ ‚Üê –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ 3
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îÇ                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ –ü–æ–º–æ—â–Ω–∏–∫ –¥–æ–Ω–µ—Ä—â–∏–∫–∞ ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ  –í—ã—à–µ–ª –Ω–∞ —Å–º–µ–Ω—É:        ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  [10:00] [12:00] [14:00]‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îÇ                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ –î–æ–Ω–µ—Ä—â–∏–∫ –∏ –ø–æ–º–æ—â–Ω–∏–∫ ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ  –î–æ–Ω–µ—Ä—â–∏–∫:  [–ë–µ–∫–∞      ]‚îÇ    ‚îÇ ‚Üê –∞–≤—Ç–æ–ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—á–µ—Ä–∞—à–Ω–∏—Ö
‚îÇ  ‚îÇ  –ü–æ–º–æ—â–Ω–∏–∫:  [–°–µ—Ä–∂–∞–Ω    ]‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îÇ                                 ‚îÇ
‚îÇ         [ –î–∞–ª–µ–µ ‚Üí ]             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–≠–∫—Ä–∞–Ω 2 ‚Äî –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞—Ä–ø–ª–∞—Ç (–ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è "–î–∞–ª–µ–µ"):**

–ë—ç–∫–µ–Ω–¥ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∑–∞—Ä–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ `cashier_salary.py` –∏ `doner_salary.py`:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –ó–∞—Ä–ø–ª–∞—Ç—ã –∑–∞ 17.02.2026       ‚îÇ
‚îÇ                                 ‚îÇ
‚îÇ  –ö–∞—Å—Å–∏—Ä –ú–µ—Ä—É–µ—Ä—Ç      12 000 ‚Ç∏  ‚îÇ
‚îÇ  –ö–∞—Å—Å–∏—Ä –ë–∞—Ç–∏–º–∞        12 000 ‚Ç∏  ‚îÇ
‚îÇ  –ü–æ–º–æ—â–Ω–∏–∫ –°–µ—Ä–∂–∞–Ω       9 000 ‚Ç∏  ‚îÇ
‚îÇ  –î–æ–Ω–µ—Ä—â–∏–∫ –ë–µ–∫–∞        11 000 ‚Ç∏  ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ    ‚îÇ
‚îÇ  –ò—Ç–æ–≥–æ:               44 000 ‚Ç∏  ‚îÇ
‚îÇ                                 ‚îÇ
‚îÇ  [ ‚Üê –ù–∞–∑–∞–¥ ]  [ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å ]  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å":**
- API –≤—ã–∑—ã–≤–∞–µ—Ç `CashierSalaryCalculator.create_salary_transactions()` –∏ `DonerSalaryCalculator.create_salary_transaction()`
- –°–æ–∑–¥–∞—é—Ç—Å—è 4-5 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ Poster (–∫–∞—Ç–µ–≥–æ—Ä–∏—è "–ö–∞—Å—Å–∏—Ä—ã" ID=16, "–î–æ–Ω–µ—Ä—â–∏–∫" ID=19, —Å—á—ë—Ç "–û—Å—Ç–∞–≤–∏–ª –≤ –∫–∞—Å—Å–µ" ID=4)
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∑–µ–ª—ë–Ω–∞—è –≥–∞–ª–æ—á–∫–∞ "–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω—ã"
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –∫ –®–∞–≥—É 2

---

### –®–∞–≥ 2: –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ö–∞—Å—Å–∏—Ä–∞ ‚Äî 5 –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è

**–≠–∫—Ä–∞–Ω 3 (–ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∑–∞—Ä–ø–ª–∞—Ç):**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –î–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è —Å–º–µ–Ω—ã     ‚îÇ
‚îÇ                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ –ë–µ–∑–Ω–∞–ª ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ  Wolt:    [          0 ]‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  Halyk:   [          0 ]‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îÇ                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ –ù–∞–ª–∏—á–Ω—ã–µ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ  –ë—É–º–∞–∂–Ω—ã–µ: [         0 ]‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  –ú–µ–ª–æ—á—å:   [         0 ]‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îÇ                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ –†–∞—Å—Ö–æ–¥—ã ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ  –†–∞—Å—Ö–æ–¥—ã —Å –∫–∞—Å—Å—ã: [   0 ]‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îÇ                                 ‚îÇ
‚îÇ         [ –û—Ç–ø—Ä–∞–≤–∏—Ç—å ]           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å":**
- –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `cashier_shift_data`
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∑–µ–ª—ë–Ω–∞—è –≥–∞–ª–æ—á–∫–∞ "–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã"
- –£ –≤–ª–∞–¥–µ–ª—å—Ü–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∑–∞–∫—Ä—ã—Ç–∏—è —Å–º–µ–Ω—ã —ç—Ç–∏ 5 –ø–æ–ª–µ–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ç—è–≥–∏–≤–∞—é—Ç—Å—è

---

### –®–∞–≥ 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º

**–ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤–ª–∞–¥–µ–ª—å—Ü–∞ (ShiftClosing.tsx / Mini App):**

–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ poster-data endpoint –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `cashier_shift_data` –∑–∞ —Å–µ–≥–æ–¥–Ω—è:
- –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –µ—Å—Ç—å ‚Üí –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω—è–µ—Ç: `wolt`, `halyk`, `cash_bills`, `cash_coins`, `expenses`
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä: "–î–∞–Ω–Ω—ã–µ –æ—Ç –∫–∞—Å—Å–∏—Ä–∞" (–∑–µ–ª—ë–Ω—ã–π badge)
- `kaspi_cafe` —É–∂–µ –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è –∏–∑ –∑–∞–∫—Ä—ã—Ç–∏—è –ö–∞—Ñ–µ (—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ª–æ–≥–∏–∫–∞ —á–µ—Ä–µ–∑ `cafe_kaspi_pizzburg`)

**–ò—Ç–æ–≥–æ –≤–ª–∞–¥–µ–ª—å—Ü—É –æ—Å—Ç–∞—ë—Ç—Å—è –≤–≤–µ—Å—Ç–∏ —Ç–æ–ª—å–∫–æ:**
- `kaspi` (Kaspi –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –æ—Ç–¥–µ–ª–∞ ‚Äî –∏–∑ –±–∞–Ω–∫–æ–≤—Å–∫–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)

–í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —É–∂–µ –Ω–∞ –º–µ—Å—Ç–µ.

---

### –®–∞–≥ 4: –ê–≤—Ç–æ-–ø–µ—Ä–µ–≤–æ–¥—ã –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è —Å–º–µ–Ω—ã

**–¢—Ä–∏–≥–≥–µ—Ä:** –ù–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç" (—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∫–Ω–æ–ø–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö –∑–∞–∫—Ä—ã—Ç–∏—è —Å–º–µ–Ω—ã –ö–∞—Ñ–µ –∏ –û—Å–Ω–æ–≤–Ω–æ–≥–æ –æ—Ç–¥–µ–ª–∞).

**–õ–æ–≥–∏–∫–∞:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç"
2. –û—Ç—á—ë—Ç –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤ –±—É—Ñ–µ—Ä (–∫–∞–∫ —Å–µ–π—á–∞—Å)
3. **–ü–ª—é—Å** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –ø–µ—Ä–µ–≤–æ–¥—ã –≤ Poster
4. –ö–Ω–æ–ø–∫–∞ –º–µ–Ω—è–µ—Ç —Ç–µ–∫—Å—Ç: "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏ —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–µ–≤–æ–¥—ã" ‚Üí "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç (–ø–µ—Ä–µ–≤–æ–¥—ã —Å–æ–∑–¥–∞–Ω—ã)"

**–ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–µ–π:**
- –í —Ç–∞–±–ª–∏—Ü–µ `shift_closings` –Ω–æ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: `transfers_created BOOLEAN DEFAULT FALSE`
- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ ‚Üí `transfers_created = true`
- –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –Ω–∞–∂–∞—Ç–∏–∏ ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–ª–∞–≥: –µ—Å–ª–∏ `true` ‚Üí —Ç–æ–ª—å–∫–æ –∫–æ–ø–∏—Ä—É–µ–º –æ—Ç—á—ë—Ç, –ø–µ—Ä–µ–≤–æ–¥—ã –ù–ï —Å–æ–∑–¥–∞—ë–º
- –í –æ—Ç—á—ë—Ç–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —Å—Ç—Ä–æ–∫–∞ "–ü–µ—Ä–µ–≤–æ–¥—ã —Å–æ–∑–¥–∞–Ω—ã" –∏–ª–∏ "–ü–µ—Ä–µ–≤–æ–¥—ã: —É–∂–µ —Å–æ–∑–¥–∞–Ω—ã —Ä–∞–Ω–µ–µ"

**–ü–µ—Ä–µ–≤–æ–¥—ã –ö–∞—Ñ–µ** (–ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å" –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ö–∞—Ñ–µ):

| –ü–µ—Ä–µ–≤–æ–¥ | –°–æ —Å—á—ë—Ç–∞ | –ù–∞ —Å—á—ë—Ç | –°—É–º–º–∞ | –ò—Å—Ç–æ—á–Ω–∏–∫ |
|---------|----------|---------|-------|----------|
| –ò–Ω–∫–∞—Å—Å–∞—Ü–∏—è –ö–∞—Ñ–µ | –ò–Ω–∫–∞—Å—Å–∞—Ü–∏—è | –û—Å—Ç–∞–≤–∏–ª –≤ –∫–∞—Å—Å–µ (–ö–∞—Ñ–µ) | `cafe_collection` | –†–∞—Å—Å—á–∏—Ç–∞–Ω–æ –≤ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ö–∞—Ñ–µ |
| Wolt –ö–∞—Ñ–µ | –ö–∞—Å–ø–∏–π –ü–µ–π | –í–æ–ª—å—Ç (–ö–∞—Ñ–µ) | `cafe_wolt` | –í–≤–µ–¥–µ–Ω–æ –∞–¥–º–∏–Ω–æ–º –ö–∞—Ñ–µ –Ω–∞ —Å–∞–π—Ç–µ |

**–ü–µ—Ä–µ–≤–æ–¥—ã –û—Å–Ω–æ–≤–Ω–æ–≥–æ** (–ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å" –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤–ª–∞–¥–µ–ª—å—Ü–∞):

| –ü–µ—Ä–µ–≤–æ–¥ | –°–æ —Å—á—ë—Ç–∞ | –ù–∞ —Å—á—ë—Ç | –°—É–º–º–∞ | –ò—Å—Ç–æ—á–Ω–∏–∫ |
|---------|----------|---------|-------|----------|
| –ò–Ω–∫–∞—Å—Å–∞—Ü–∏—è | –ò–Ω–∫–∞—Å—Å–∞—Ü–∏—è | –û—Å—Ç–∞–≤–∏–ª –≤ –∫–∞—Å—Å–µ (–û—Å–Ω–æ–≤–Ω–æ–π) | `collection` | –†–∞—Å—Å—á–∏—Ç–∞–Ω–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤–ª–∞–¥–µ–ª—å—Ü–∞ |
| Wolt | –ö–∞—Å–ø–∏–π –ü–µ–π | –í–æ–ª—å—Ç (–û—Å–Ω–æ–≤–Ω–æ–π) | `wolt` | –í–≤–µ–¥–µ–Ω–æ –∫–∞—Å—Å–∏—Ä–æ–º (–®–∞–≥ 2) |
| Halyk | –ö–∞—Å–ø–∏–π –ü–µ–π | Halyk (–û—Å–Ω–æ–≤–Ω–æ–π) | `halyk` | –í–≤–µ–¥–µ–Ω–æ –∫–∞—Å—Å–∏—Ä–æ–º (–®–∞–≥ 2) |

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç" ‚Üí `POST /api/.../transfers` (–µ—Å–ª–∏ `transfers_created == false`)
- –ö–∞–∂–¥—ã–π –ø–µ—Ä–µ–≤–æ–¥ ‚Üí `finance.createTransaction` —Å `type=2` (transfer)
- –û—Ç–≤–µ—Ç API —Å–æ–¥–µ—Ä–∂–∏—Ç ID —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ `shift_closings`
- UI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫—Ä–∞—Ç–∫–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: "–û—Ç—á—ë—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω, 3 –ø–µ—Ä–µ–≤–æ–¥–∞ —Å–æ–∑–¥–∞–Ω—ã"

> **–í–ê–ñ–ù–û:** –ù—É–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å ID —Å—á–µ—Ç–æ–≤ "–ò–Ω–∫–∞—Å—Å–∞—Ü–∏—è" –∏ "–í–æ–ª—å—Ç" –≤ Poster. –ü–æ–ª—É—á–∏—Ç—å —á–µ—Ä–µ–∑ `finance.getAccounts`.

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

#### –¢–∞–±–ª–∏—Ü–∞ `cashier_access_tokens` (–Ω–æ–≤–∞—è)
```sql
CREATE TABLE cashier_access_tokens (
    id INTEGER PRIMARY KEY,
    token TEXT UNIQUE NOT NULL,
    telegram_user_id BIGINT NOT NULL,
    poster_account_id INTEGER NOT NULL,  -- ID –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ (is_primary=true)
    label TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (telegram_user_id) REFERENCES users(telegram_user_id)
);
```
–ü–∞—Ç—Ç–µ—Ä–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–≤—Ç–æ—Ä—è–µ—Ç `cafe_access_tokens`, –Ω–æ `poster_account_id` —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ **–æ—Å–Ω–æ–≤–Ω–æ–π** –∞–∫–∫–∞—É–Ω—Ç (Pizzburg), –∞ –Ω–µ –Ω–∞ –ö–∞—Ñ–µ.

#### –¢–∞–±–ª–∏—Ü–∞ `cashier_shift_data` (–Ω–æ–≤–∞—è)
```sql
CREATE TABLE cashier_shift_data (
    id INTEGER PRIMARY KEY,
    telegram_user_id BIGINT NOT NULL,
    date TEXT NOT NULL,                    -- YYYY-MM-DD
    -- –®–∞–≥ 1: –ó–∞—Ä–ø–ª–∞—Ç—ã
    cashier_count INTEGER,                 -- 2 –∏–ª–∏ 3
    cashier_names TEXT,                    -- JSON array: ["–ú–µ—Ä—É–µ—Ä—Ç", "–ë–∞—Ç–∏–º–∞"]
    assistant_start_time TEXT,             -- "10:00" | "12:00" | "14:00"
    doner_name TEXT,
    assistant_name TEXT,
    salaries_data TEXT,                    -- JSON: —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–µ –∑–∞—Ä–ø–ª–∞—Ç—ã
    salaries_created BOOLEAN DEFAULT FALSE,-- —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω—ã?
    -- –®–∞–≥ 2: 5 –∑–Ω–∞—á–µ–Ω–∏–π
    wolt REAL DEFAULT 0,
    halyk REAL DEFAULT 0,
    cash_bills REAL DEFAULT 0,
    cash_coins REAL DEFAULT 0,
    expenses REAL DEFAULT 0,
    shift_data_submitted BOOLEAN DEFAULT FALSE,  -- –¥–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã?
    -- –ú–µ—Ç–∞
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(telegram_user_id, date)
);
```

### 2. –ú–µ—Ç–æ–¥—ã database.py (–Ω–æ–≤—ã–µ)

```python
# –¢–æ–∫–µ–Ω—ã
create_cashier_token(telegram_user_id, poster_account_id, label) -> str
get_cashier_token(token) -> Optional[Dict]  # –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç user_id + poster credentials
list_cashier_tokens(telegram_user_id) -> list
delete_cashier_token(token_id, telegram_user_id) -> bool

# –î–∞–Ω–Ω—ã–µ –∫–∞—Å—Å–∏—Ä–∞
save_cashier_shift_data(telegram_user_id, date, data) -> bool  # upsert
get_cashier_shift_data(telegram_user_id, date) -> Optional[Dict]
get_cashier_last_employees(telegram_user_id) -> Optional[Dict]  # –≤—á–µ—Ä–∞—à–Ω–∏–µ –∏–º–µ–Ω–∞
```

### 3. –ö–æ–º–∞–Ω–¥–∞ –±–æ—Ç–∞ `/cashier_token`

–ü–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ–ø–∏—Ä—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω `/cafe_token`:
```
/cashier_token list              ‚Äî —Å–ø–∏—Å–æ–∫ —Ç–æ–∫–µ–Ω–æ–≤
/cashier_token create [–º–µ—Ç–∫–∞]    ‚Äî —Å–æ–∑–¥–∞—Ç—å —Ç–æ–∫–µ–Ω (–ø—Ä–∏–≤—è–∑–∫–∞ –∫ PRIMARY –∞–∫–∫–∞—É–Ω—Ç—É)
/cashier_token delete <id>       ‚Äî —É–¥–∞–ª–∏—Ç—å —Ç–æ–∫–µ–Ω
```

–†–∞–∑–Ω–∏—Ü–∞ —Å `/cafe_token`:
- –ò—â–µ—Ç **primary** –∞–∫–∫–∞—É–Ω—Ç –≤–º–µ—Å—Ç–æ non-primary
- URL: `/cashier/{token}/shift-closing`

### 4. Flask routes (web_app.py)

#### –°—Ç—Ä–∞–Ω–∏—Ü–∞
```
GET /cashier/<token>/shift-closing
    ‚Üí render_template('shift_closing_cashier.html', token=token, account_name=...)
```

#### API –¥–ª—è –∑–∞—Ä–ø–ª–∞—Ç
```
POST /api/cashier/<token>/salaries/calculate
    Body: { cashier_count: 2|3, assistant_start_time: "10:00"|"12:00"|"14:00" }
    ‚Üí –í—ã–∑—ã–≤–∞–µ—Ç CashierSalaryCalculator.get_total_sales() + calculate_salary()
    ‚Üí –í—ã–∑—ã–≤–∞–µ—Ç DonerSalaryCalculator.get_doner_sales_count() + calculate_salary()
    ‚Üí –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: { cashier_salary: 12000, doner_salary: 11000, assistant_salary: 9000 }
    (–ù–ï —Å–æ–∑–¥–∞—ë—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, —Ç–æ–ª—å–∫–æ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç)

POST /api/cashier/<token>/salaries/create
    Body: {
        cashier_count: 2,
        cashier_names: ["–ú–µ—Ä—É–µ—Ä—Ç", "–ë–∞—Ç–∏–º–∞"],
        assistant_start_time: "12:00",
        doner_name: "–ë–µ–∫–∞",
        assistant_name: "–°–µ—Ä–∂–∞–Ω"
    }
    ‚Üí –í—ã–∑—ã–≤–∞–µ—Ç create_salary_transactions() –∏ create_salary_transaction()
    ‚Üí –°–æ–∑–¥–∞—ë—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ Poster
    ‚Üí –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ cashier_shift_data (salaries_created = true)
    ‚Üí –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: { success: true, salaries: [...] }
```

#### API –¥–ª—è –¥–∞–Ω–Ω—ã—Ö —Å–º–µ–Ω—ã
```
POST /api/cashier/<token>/shift-data/save
    Body: { wolt: 45000, halyk: 120000, cash_bills: 890000, cash_coins: 15000, expenses: 35000 }
    ‚Üí –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ cashier_shift_data (shift_data_submitted = true)
    ‚Üí –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: { success: true }

GET /api/cashier/<token>/employees/last
    ‚Üí –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—á–µ—Ä–∞—à–Ω–∏–µ –∏–º–µ–Ω–∞ –∏–∑ cashier_shift_data –∏–ª–∏ employees —Ç–∞–±–ª–∏—Ü—ã
    ‚Üí { cashier_names: ["–ú–µ—Ä—É–µ—Ä—Ç", "–ë–∞—Ç–∏–º–∞"], doner_name: "–ë–µ–∫–∞", assistant_name: "–°–µ—Ä–∂–∞–Ω",
        cashier_count: 2, assistant_start_time: "12:00" }
```

### 5. HTML-—à–∞–±–ª–æ–Ω `shift_closing_cashier.html`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ (–ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å `shift_closing_cafe.html`):**

```html
<!-- –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π JS -->
<script>
const TOKEN = '{{ token }}';
const API_BASE = '/api/cashier/' + TOKEN;

let currentStep = 1;  // 1=–∑–∞—Ä–ø–ª–∞—Ç—ã, 2=–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ, 3=–¥–∞–Ω–Ω—ã–µ —Å–º–µ–Ω—ã, 4=–≥–æ—Ç–æ–≤–æ

// –®–∞–≥ 1: –í–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∑–∞—Ä–ø–ª–∞—Ç
// - –ö–Ω–æ–ø–∫–∏ 2/3 –∫–∞—Å—Å–∏—Ä–∞
// - –ü–æ–ª—è –∏–º—ë–Ω —Å –∞–≤—Ç–æ–ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–æ–π
// - –ö–Ω–æ–ø–∫–∏ 10:00/12:00/14:00
// - –ö–Ω–æ–ø–∫–∞ "–î–∞–ª–µ–µ" ‚Üí POST /salaries/calculate ‚Üí –ø–æ–∫–∞–∑ –®–∞–≥–∞ 2

// –®–∞–≥ 2: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞—Ä–ø–ª–∞—Ç
// - –¢–∞–±–ª–∏—Ü–∞: –∏–º—è ‚Üí —Å—É–º–º–∞
// - –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å" ‚Üí POST /salaries/create ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –∫ –®–∞–≥—É 3
// - –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" ‚Üí –≤–æ–∑–≤—Ä–∞—Ç –∫ –®–∞–≥—É 1

// –®–∞–≥ 3: 5 –ø–æ–ª–µ–π –≤–≤–æ–¥–∞
// - Wolt, Halyk, –ë—É–º–∞–∂–Ω—ã–µ, –ú–µ–ª–æ—á—å, –†–∞—Å—Ö–æ–¥—ã
// - –ö–Ω–æ–ø–∫–∞ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å" ‚Üí POST /shift-data/save ‚Üí –®–∞–≥ 4

// –®–∞–≥ 4: –ì–æ—Ç–æ–≤–æ
// - "–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã. –°–ø–∞—Å–∏–±–æ!"
</script>
```

**UI —Å—Ç–∏–ª–∏:** –ü–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ–ø–∏—Ä—É–µ–º –∏–∑ `shift_closing_cafe.html` (iOS-style, mobile-optimized).

### 6. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º

**–í `web_app.py`, endpoint `GET /api/shift-closing/poster-data`:**

```python
# –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ª–æ–≥–∏–∫–∞ (—É–∂–µ –µ—Å—Ç—å):
# - cafe_kaspi_pizzburg –∏–∑ shift_closings –ö–∞—Ñ–µ

# –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞:
# –ü—Ä–æ–≤–µ—Ä—è–µ–º cashier_shift_data –∑–∞ —Å–µ–≥–æ–¥–Ω—è
cashier_data = db.get_cashier_shift_data(user_id, date_str)
if cashier_data and cashier_data.get('shift_data_submitted'):
    data['cashier_wolt'] = cashier_data.get('wolt', 0)
    data['cashier_halyk'] = cashier_data.get('halyk', 0)
    data['cashier_cash_bills'] = cashier_data.get('cash_bills', 0)
    data['cashier_cash_coins'] = cashier_data.get('cash_coins', 0)
    data['cashier_expenses'] = cashier_data.get('expenses', 0)
    data['cashier_data_submitted'] = True
```

**–í `ShiftClosing.tsx` (Mini App):**

```typescript
// –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ posterData, –µ—Å–ª–∏ cashier_data_submitted:
if (posterData.cashier_data_submitted) {
    setInputs(prev => ({
        ...prev,
        wolt: String(posterData.cashier_wolt || ''),
        halyk: String(posterData.cashier_halyk || ''),
        cashBills: String(posterData.cashier_cash_bills || ''),
        cashCoins: String(posterData.cashier_cash_coins || ''),
        expenses: String(posterData.cashier_expenses || ''),
    }))
    // –ü–æ–∫–∞–∑–∞—Ç—å badge "–î–∞–Ω–Ω—ã–µ –æ—Ç –∫–∞—Å—Å–∏—Ä–∞"
}
```

### 7. –ê–≤—Ç–æ-–ø–µ—Ä–µ–≤–æ–¥—ã (–ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –∫–Ω–æ–ø–∫–µ "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç")

#### Endpoint –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤
```
POST /api/shift-closing/transfers
    ‚Üí –ß–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ shift_closings –∑–∞ –¥–∞—Ç—É
    ‚Üí –ü—Ä–æ–≤–µ—Ä—è–µ—Ç transfers_created: –µ—Å–ª–∏ true ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç { already_created: true }
    ‚Üí –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (collection, wolt, halyk)
    ‚Üí –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞: poster_client.create_transaction(type=2, ...)
    ‚Üí –°—Ç–∞–≤–∏—Ç transfers_created = true
    ‚Üí –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: { success: true, created_count: 3 }

POST /api/cafe/<token>/transfers
    ‚Üí –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ, –Ω–æ –¥–ª—è –ö–∞—Ñ–µ (2 –ø–µ—Ä–µ–≤–æ–¥–∞: –∏–Ω–∫–∞—Å—Å–∞—Ü–∏—è + wolt)
```

#### –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î (shift_closings)
```sql
ALTER TABLE shift_closings ADD COLUMN transfers_created BOOLEAN DEFAULT FALSE;
```

#### –ü–æ–≤–µ–¥–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç"
```
–ü–µ—Ä–≤–æ–µ –Ω–∞–∂–∞—Ç–∏–µ (transfers_created = false):
  1. –ö–æ–ø–∏—Ä—É–µ—Ç –æ—Ç—á—ë—Ç –≤ –±—É—Ñ–µ—Ä
  2. POST /transfers ‚Üí —Å–æ–∑–¥–∞—ë—Ç –ø–µ—Ä–µ–≤–æ–¥—ã –≤ Poster
  3. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: "–û—Ç—á—ë—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω, 3 –ø–µ—Ä–µ–≤–æ–¥–∞ —Å–æ–∑–¥–∞–Ω—ã"
  4. –¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏: "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç (–ø–µ—Ä–µ–≤–æ–¥—ã —Å–æ–∑–¥–∞–Ω—ã ‚úì)"

–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –Ω–∞–∂–∞—Ç–∏–µ (transfers_created = true):
  1. –ö–æ–ø–∏—Ä—É–µ—Ç –æ—Ç—á—ë—Ç –≤ –±—É—Ñ–µ—Ä
  2. –ù–ï —Å–æ–∑–¥–∞—ë—Ç –ø–µ—Ä–µ–≤–æ–¥—ã
  3. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: "–û—Ç—á—ë—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω"
```

---

## –ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –§–∞–∑–∞ 1A: –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ö–∞—Å—Å–∏—Ä–∞ ‚Äî –ì–û–¢–û–í–û ‚úÖ
1. ~~–¢–∞–±–ª–∏—Ü—ã `cashier_access_tokens` + `cashier_shift_data` –≤ database.py~~
2. ~~CRUD-–º–µ—Ç–æ–¥—ã –¥–ª—è —Ç–æ–∫–µ–Ω–æ–≤ –∏ –¥–∞–Ω–Ω—ã—Ö –∫–∞—Å—Å–∏—Ä–∞ –≤ database.py~~
3. ~~–ö–æ–º–∞–Ω–¥–∞ `/cashier_token` –≤ bot.py~~
4. ~~Flask routes –≤ web_app.py (6 endpoints)~~
5. ~~HTML-—à–∞–±–ª–æ–Ω `shift_closing_cashier.html`~~
6. ~~–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è: –¥–∞–Ω–Ω—ã–µ –∫–∞—Å—Å–∏—Ä–∞ ‚Üí poster-data endpoint ‚Üí ShiftClosing.tsx~~

### –§–∞–∑–∞ 1.5: –°–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å —Ä–æ–ª—è–º–∏ ‚Äî –¢–ï–ö–£–©–ê–Ø

> **–ü—Ä–æ–±–ª–µ–º–∞:** –°–µ–π—á–∞—Å —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∑–∞—â–∏—â–µ–Ω—ã —Ç–æ–ª—å–∫–æ —Å–µ–∫—Ä–µ—Ç–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º –≤ URL. –ï—Å–ª–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ —É–±–µ—Ä—ë—Ç —Ç–æ–∫–µ–Ω –∏ –∑–∞–π–¥—ë—Ç –Ω–∞ –∫–æ—Ä–Ω–µ–≤–æ–π URL ‚Äî –æ–Ω —É–≤–∏–¥–∏—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–ª–∞–¥–µ–ª—å—Ü–∞. –ù–µ—Ç –Ω–∏–∫–∞–∫–æ–π –∏–∑–æ–ª—è—Ü–∏–∏.
>
> **–¶–µ–ª—å:** –ó–∞–º–µ–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω—ã –Ω–∞ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å —Å —Ä–æ–ª—è–º–∏. –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã. –ë–µ–∑ –ª–æ–≥–∏–Ω–∞ ‚Äî –Ω–∏—á–µ–≥–æ –Ω–µ –≤–∏–¥–Ω–æ, —Ç–æ–ª—å–∫–æ —Ñ–æ—Ä–º–∞ –≤—Ö–æ–¥–∞.

#### –†–æ–ª–∏ –∏ –¥–æ—Å—Ç—É–ø

| –†–æ–ª—å | –ö—Ç–æ | –î–æ—Å—Ç—É–ø | –ö–æ–ª-–≤–æ |
|------|-----|--------|--------|
| `owner` | –í–ª–∞–¥–µ–ª–µ—Ü, –ø–∞—Ä—Ç–Ω—ë—Ä | **–í—Å—ë**: —Ä–∞—Å—Ö–æ–¥—ã, –ø–æ—Å—Ç–∞–≤–∫–∏, –∞–ª–∏–∞—Å—ã, –∑–∞–∫—Ä—ã—Ç–∏–µ —Å–º–µ–Ω—ã, Mini App, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ | 2 |
| `admin` | –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ö–∞—Ñ–µ | **–¢–æ–ª—å–∫–æ**: –∑–∞–∫—Ä—ã—Ç–∏–µ —Å–º–µ–Ω—ã –ö–∞—Ñ–µ (`/cafe/shift-closing`) | 1 |
| `cashier` | –ö–∞—Å—Å–∏—Ä –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –æ—Ç–¥–µ–ª–∞ | **–¢–æ–ª—å–∫–æ**: —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–∞—Å—Å–∏—Ä–∞ (`/cashier/shift-closing`) | 2 (—Ä–∞–∑–Ω—ã–µ —Å–º–µ–Ω—ã) |

#### –ü–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

```
–ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:
  –õ—é–±–æ–π URL ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /login

–í–ª–∞–¥–µ–ª–µ—Ü (owner):
  / ‚Üí /expenses (–∏–ª–∏ /mini-app, –∫–∞–∫ —Å–µ–π—á–∞—Å)
  /expenses, /supplies, /aliases, /shift-closing, /mini-app, /api/* ‚Üí –¥–æ—Å—Ç—É–ø
  /cafe/shift-closing, /cashier/shift-closing ‚Üí –¥–æ—Å—Ç—É–ø (–º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å –≤—Å—ë)

–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä (admin):
  / ‚Üí /cafe/shift-closing (–∞–≤—Ç–æ—Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Å–≤–æ—é —Å—Ç—Ä–∞–Ω–∏—Ü—É)
  /cafe/shift-closing ‚Üí –¥–æ—Å—Ç—É–ø
  /api/cafe/* ‚Üí –¥–æ—Å—Ç—É–ø
  –í—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Üí 403 –∏–ª–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /cafe/shift-closing

–ö–∞—Å—Å–∏—Ä (cashier):
  / ‚Üí /cashier/shift-closing (–∞–≤—Ç–æ—Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Å–≤–æ—é —Å—Ç—Ä–∞–Ω–∏—Ü—É)
  /cashier/shift-closing ‚Üí –¥–æ—Å—Ç—É–ø
  /api/cashier/* ‚Üí –¥–æ—Å—Ç—É–ø
  –í—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Üí 403 –∏–ª–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /cashier/shift-closing
```

#### 1. –¢–∞–±–ª–∏—Ü–∞ `web_users` (–Ω–æ–≤–∞—è)

```sql
CREATE TABLE web_users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    telegram_user_id BIGINT NOT NULL,        -- –≤–ª–∞–¥–µ–ª–µ—Ü, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –ø—Ä–∏–≤—è–∑–∞–Ω
    username TEXT UNIQUE NOT NULL,            -- –ª–æ–≥–∏–Ω (–ª–∞—Ç–∏–Ω–∏—Ü–∞)
    password_hash TEXT NOT NULL,              -- bcrypt hash
    role TEXT NOT NULL CHECK(role IN ('owner', 'admin', 'cashier')),
    label TEXT,                               -- "–ú–µ—Ä—É–µ—Ä—Ç", "–ë–∞—Ç–∏–º–∞", –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    poster_account_id INTEGER,               -- –¥–ª—è admin: ID –∞–∫–∫–∞—É–Ω—Ç–∞ –ö–∞—Ñ–µ; –¥–ª—è cashier: ID –æ—Å–Ω–æ–≤–Ω–æ–≥–æ
    is_active BOOLEAN DEFAULT TRUE,          -- –º–æ–∂–Ω–æ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑ —É–¥–∞–ª–µ–Ω–∏—è
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_login TIMESTAMP,
    FOREIGN KEY (telegram_user_id) REFERENCES users(telegram_user_id)
);
```

**–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø–∏—Å–µ–π:**
| username | role | label | poster_account_id |
|----------|------|-------|-------------------|
| `boss` | owner | –í–ª–∞–¥–µ–ª–µ—Ü | NULL (–ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø) |
| `partner` | owner | –ü–∞—Ä—Ç–Ω—ë—Ä | NULL (–ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø) |
| `aisulu` | admin | –ê–π—Å—É–ª—É | 15 (Pizzburg-Cafe) |
| `meruyert` | cashier | –ú–µ—Ä—É–µ—Ä—Ç | 10 (Pizzburg –æ—Å–Ω–æ–≤–Ω–æ–π) |
| `batima` | cashier | –ë–∞—Ç–∏–º–∞ | 10 (Pizzburg –æ—Å–Ω–æ–≤–Ω–æ–π) |

#### 2. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ª–æ–≥–∏–Ω–∞ (`/login`)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                 ‚îÇ
‚îÇ     üîí Poster Helper           ‚îÇ
‚îÇ                                 ‚îÇ
‚îÇ  –õ–æ–≥–∏–Ω:    [                 ]  ‚îÇ
‚îÇ  –ü–∞—Ä–æ–ª—å:   [                 ]  ‚îÇ
‚îÇ                                 ‚îÇ
‚îÇ         [  –í–æ–π—Ç–∏  ]             ‚îÇ
‚îÇ                                 ‚îÇ
‚îÇ  (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å)    ‚îÇ
‚îÇ                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

- –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –¥–∏–∑–∞–π–Ω, mobile-friendly
- –®–∞–±–ª–æ–Ω: `templates/login.html`
- POST `/login` ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏–Ω–∞/–ø–∞—Ä–æ–ª—è ‚Üí —Å–æ–∑–¥–∞–Ω–∏–µ Flask session ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –ø–æ —Ä–æ–ª–∏
- GET `/logout` ‚Üí –æ—á–∏—Å—Ç–∫–∞ session ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/login`

#### 3. Flask session –∏ middleware

**–°–µ—Å—Å–∏—è:**
```python
# –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –ª–æ–≥–∏–Ω–µ:
session['user_id'] = web_user['id']
session['role'] = web_user['role']
session['telegram_user_id'] = web_user['telegram_user_id']
session['poster_account_id'] = web_user['poster_account_id']
session['label'] = web_user['label']
```

**Middleware (`@app.before_request`):**
```python
# –û—Ç–∫—Ä—ã—Ç—ã–µ –ø—É—Ç–∏ (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏):
OPEN_PATHS = ['/login', '/static', '/favicon.ico']

# –ü—É—Ç—å ‚Üí –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–æ–ª—å:
ROLE_ACCESS = {
    '/cafe/shift-closing': ['owner', 'admin'],
    '/api/cafe/': ['owner', 'admin'],
    '/cashier/shift-closing': ['owner', 'cashier'],
    '/api/cashier/': ['owner', 'cashier'],
    # –í—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ: —Ç–æ–ª—å–∫–æ owner
}

@app.before_request
def check_auth():
    # 1. –û—Ç–∫—Ä—ã—Ç—ã–µ –ø—É—Ç–∏ ‚Äî –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
    # 2. –ù–µ—Ç session ‚Üí redirect /login
    # 3. –ï—Å—Ç—å session ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ä–æ–ª—å:
    #    - owner ‚Üí –¥–æ—Å—Ç—É–ø –≤–µ–∑–¥–µ
    #    - admin ‚Üí —Ç–æ–ª—å–∫–æ /cafe/* –∏ /api/cafe/*
    #    - cashier ‚Üí —Ç–æ–ª—å–∫–æ /cashier/* –∏ /api/cashier/*
    # 4. –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ ‚Üí redirect –Ω–∞ "—Å–≤–æ—é" —Å—Ç—Ä–∞–Ω–∏—Ü—É
```

#### 4. –ó–∞–º–µ–Ω–∞ URL-—Å—Ö–µ–º—ã (—É–±–∏—Ä–∞–µ–º —Ç–æ–∫–µ–Ω—ã –∏–∑ URL)

**–ë—ã–ª–æ (—Ç–æ–∫–µ–Ω –≤ URL):**
```
/cafe/{token}/shift-closing
/api/cafe/{token}/poster-data
/api/cafe/{token}/calculate
...
/cashier/{token}/shift-closing
/api/cashier/{token}/salaries/calculate
...
```

**–°—Ç–∞–ª–æ (session-based):**
```
/cafe/shift-closing
/api/cafe/poster-data
/api/cafe/calculate
...
/cashier/shift-closing
/api/cashier/salaries/calculate
...
```

–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Äî —á–µ—Ä–µ–∑ Flask session (`session['telegram_user_id']` + `session['poster_account_id']`), –∞ –Ω–µ —á–µ—Ä–µ–∑ —Ç–æ–∫–µ–Ω –≤ URL.

**–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:**
- –°—Ç–∞—Ä—ã–µ —Å—Å—ã–ª–∫–∏ `/cafe/{token}/shift-closing` ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/login` (–∏–ª–∏ –Ω–∞ `/cafe/shift-closing` –µ—Å–ª–∏ —É–∂–µ –∑–∞–ª–æ–≥–∏–Ω–µ–Ω)
- –¢–æ–∫–µ–Ω-—Ç–∞–±–ª–∏—Ü—ã (`cafe_access_tokens`, `cashier_access_tokens`) ‚Äî –æ—Å—Ç–∞–≤–ª—è–µ–º –ø–æ–∫–∞, –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –ø–æ–∑–∂–µ

#### 5. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö API endpoints

**–î–ª—è owner-only endpoints** (`/api/expenses`, `/api/supplies`, etc.):
```python
# –°–µ–π—á–∞—Å: g.user_id –∏–∑ Telegram init_data –∏–ª–∏ TELEGRAM_USER_ID
# –ü–æ—Å–ª–µ: g.user_id –∏–∑ session['telegram_user_id']
# –û–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ —Ä–∞–±–æ—Ç–∞—é—Ç (Mini App —á–µ—Ä–µ–∑ header, web —á–µ—Ä–µ–∑ session)
```

**–î–ª—è cafe endpoints** (`/api/cafe/*`):
```python
# –°–µ–π—á–∞—Å: resolve_cafe_token(token) ‚Üí info
# –ü–æ—Å–ª–µ: info –∏–∑ session (telegram_user_id + poster_account_id)
# –•–µ–ª–ø–µ—Ä: resolve_cafe_session() –≤–º–µ—Å—Ç–æ resolve_cafe_token()
```

**–î–ª—è cashier endpoints** (`/api/cashier/*`):
```python
# –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ cafe ‚Äî session –≤–º–µ—Å—Ç–æ token
```

#### 6. –ö–æ–º–∞–Ω–¥–∞ –±–æ—Ç–∞ `/staff` (–∑–∞–º–µ–Ω–∞ `/cafe_token` –∏ `/cashier_token`)

```
/staff list                              ‚Äî —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤
/staff create owner <–ª–æ–≥–∏–Ω> <–ø–∞—Ä–æ–ª—å>     ‚Äî —Å–æ–∑–¥–∞—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü–∞
/staff create admin <–ª–æ–≥–∏–Ω> <–ø–∞—Ä–æ–ª—å>     ‚Äî —Å–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω–∞ (–ø—Ä–∏–≤—è–∑–∫–∞ –∫ –ö–∞—Ñ–µ)
/staff create cashier <–ª–æ–≥–∏–Ω> <–ø–∞—Ä–æ–ª—å>   ‚Äî —Å–æ–∑–¥–∞—Ç—å –∫–∞—Å—Å–∏—Ä–∞ (–ø—Ä–∏–≤—è–∑–∫–∞ –∫ –û—Å–Ω–æ–≤–Ω–æ–º—É)
/staff delete <id>                       ‚Äî —É–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç
/staff reset <id> <–Ω–æ–≤—ã–π_–ø–∞—Ä–æ–ª—å>         ‚Äî —Å–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å
```

–°—Ç–∞—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã `/cafe_token` –∏ `/cashier_token` ‚Äî –æ—Å—Ç–∞–≤–ª—è–µ–º –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –∏–ª–∏ —É–±–∏—Ä–∞–µ–º.

#### 7. –ß—Ç–æ –º–µ–Ω—è–µ—Ç—Å—è –≤ —Ñ–∞–π–ª–∞—Ö

| –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏—è |
|------|-----------|
| **database.py** | + —Ç–∞–±–ª–∏—Ü–∞ `web_users`, + CRUD-–º–µ—Ç–æ–¥—ã (create/get/list/delete/verify_password/update_last_login) |
| **web_app.py** | + `/login` –∏ `/logout` routes, + `check_auth()` middleware, + `resolve_cafe_session()` / `resolve_cashier_session()` —Ö–µ–ª–ø–µ—Ä—ã, —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ cafe/cashier routes (—É–±—Ä–∞—Ç—å `<token>`) |
| **bot.py** | + –∫–æ–º–∞–Ω–¥–∞ `/staff`, (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) deprecate `/cafe_token` –∏ `/cashier_token` |
| **templates/login.html** | + –ù–æ–≤—ã–π —à–∞–±–ª–æ–Ω —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ª–æ–≥–∏–Ω–∞ |
| **templates/shift_closing_cafe.html** | –£–±—Ä–∞—Ç—å `TOKEN` –∏–∑ JS, API –≤—ã–∑–æ–≤—ã –±–µ–∑ —Ç–æ–∫–µ–Ω–∞ –≤ URL |
| **templates/shift_closing_cashier.html** | –£–±—Ä–∞—Ç—å `TOKEN` –∏–∑ JS, API –≤—ã–∑–æ–≤—ã –±–µ–∑ —Ç–æ–∫–µ–Ω–∞ –≤ URL |
| **requirements.txt** | + `bcrypt` (–¥–ª—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π) |

#### 8. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- **–ü–∞—Ä–æ–ª–∏**: bcrypt hash (–Ω–µ plain text)
- **–°–µ—Å—Å–∏–∏**: Flask session —Å `FLASK_SECRET_KEY` (—É–∂–µ –µ—Å—Ç—å)
- **CSRF**: Flask session cookies (SameSite=Lax –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- **Brute force**: –ü—Ä–æ—Å—Ç–æ–π rate limit –Ω–∞ `/login` (3-5 –ø–æ–ø—ã—Ç–æ–∫, –ø–æ—Ç–æ–º –∑–∞–¥–µ—Ä–∂–∫–∞)
- **–î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è**: `is_active = false` –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Ö–æ–¥ –±–µ–∑ —É–¥–∞–ª–µ–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞

### –§–∞–∑–∞ 1B: –ê–≤—Ç–æ-–ø–µ—Ä–µ–≤–æ–¥—ã
1. Endpoint `POST /api/shift-closing/transfers` + `POST /api/cafe/transfers`
2. –ë–ª–æ–∫ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤–ª–∞–¥–µ–ª—å—Ü–∞ (ShiftClosing.tsx)
3. –ë–ª–æ–∫ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ö–∞—Ñ–µ (shift_closing_cafe.html)

### –§–∞–∑–∞ 2: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
- –ü–æ–º–æ—â–Ω–∏–∫ –ø–æ —Ä–∞–∑–Ω–∏—Ü–µ –±–µ–∑–Ω–∞–ª–∞
- –ê–≤—Ç–æ-—Å–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–æ–≤
- –ù–∞–¥–±–∞–≤–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–∞—Å—Å–∏—Ä–∞ –∑–∞ –¥–æ—Å—Ç–∞–≤–∫—É (–∫–æ–≥–¥–∞ –ø–æ—è–≤–∏—Ç—Å—è API)

---

## –û—Ç–∫—Ä—ã—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã

1. **ID —Å—á–µ—Ç–æ–≤:** –ö–∞–∫–∏–µ ID —É "–ò–Ω–∫–∞—Å—Å–∞—Ü–∏—è" –∏ "–í–æ–ª—å—Ç" –≤ Poster? ‚Üí –ø–æ–ª—É—á–∏—Ç—å —á–µ—Ä–µ–∑ `finance.getAccounts`
2. **–î–æ—Å—Ç–∞–≤–∫–∞:** –ö–∞–∫ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∑–∞–∫–∞–∑—ã –Ω–∞ –¥–æ—Å—Ç–∞–≤–∫—É –≤ Poster API –¥–ª—è –Ω–∞–¥–±–∞–≤–∫–∏ –∫–∞—Å—Å–∏—Ä–∞?
3. **–ó–∞—Ä–ø–ª–∞—Ç—ã –ö–∞—Ñ–µ:** –ï—Å—Ç—å –ª–∏ —Ç–∞–±–ª–∏—Ü–∞ –Ω–æ—Ä–º –¥–ª—è —Å—É—à–∏—Å—Ç–∞/–∫–∞—Å—Å–∏—Ä–∞ –ö–∞—Ñ–µ?

---

## –ü—Ä–µ–¥—ã–¥—É—â–∏–µ —Ñ–∞–∑—ã (–∞—Ä—Ö–∏–≤)

<details>
<summary>–§–∞–∑–∞ 3-5: –ö–∞—Ñ–µ wizard, –ø–æ–º–æ—â–Ω–∏–∫ –±–µ–∑–Ω–∞–ª–∞, —Å–≤–µ—Ä–∫–∞ (–±—É–¥—É—â–µ–µ)</summary>

### –§–∞–∑–∞ 3: –ö–∞—Ñ–µ –∫–∞–∫ —à–∞–≥ wizard'–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞
- `CafeClosingStep.tsx` ‚Äî —Ñ–æ—Ä–º–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –ö–∞—Ñ–µ –≤ Mini App
- –°–≤—è–∑—å –ö–∞—Ñ–µ ‚Üí –æ—Å–Ω–æ–≤–Ω–æ–π (–∞–≤—Ç–æ–ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ kaspi_cafe)
- –ó–∞—Ä–ø–ª–∞—Ç—ã –ö–∞—Ñ–µ –≤ —Ç–æ–º –∂–µ —à–∞–≥–µ

### –§–∞–∑–∞ 4: –ü–æ–º–æ—â–Ω–∏–∫ –ø–æ –±–µ–∑–Ω–∞–ª—É
- Endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —á–µ–∫–æ–≤ –∑–∞ –¥–µ–Ω—å
- `ReceiptHelper.tsx` ‚Äî —Å–ø–∏—Å–æ–∫ —á–µ–∫–æ–≤ —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π
- –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ —á–µ–∫–∞ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ –º–µ—Ç–æ–¥–∞ –æ–ø–ª–∞—Ç—ã

### –§–∞–∑–∞ 5: –ê–≤—Ç–æ-—Å–≤–µ—Ä–∫–∞
- Endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–æ–≤ —Å—á–µ—Ç–æ–≤
- `ReconciliationStep.tsx` ‚Äî —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ñ–∞–∫—Ç vs Poster
- –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞, –Ω–µ –∑–∞–±—ã—Ç–∞ –ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è

</details>
